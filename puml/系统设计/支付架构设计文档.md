# æ”¯ä»˜ç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **æ›´æ–°æ—¥æœŸ**: 2025-11-12  
> **æ¶æ„å¸ˆ**: æ”¯ä»˜ç³»ç»Ÿæ¶æ„ç»„

---

## ğŸ“Š æ¶æ„å›¾ç´¢å¼•

æœ¬æ–‡æ¡£é…å¥—ä»¥ä¸‹PlantUMLæ¶æ„å›¾ï¼Œå¯ä»¥ä½¿ç”¨PlantUMLå·¥å…·æˆ–åœ¨çº¿ç¼–è¾‘å™¨æŸ¥çœ‹ï¼š

| å›¾è¡¨ç±»å‹ | æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|---------|---------|------|---------|
| ğŸ—ï¸ **ç±»å›¾** | `æ”¯ä»˜æ¶æ„-ç±»å›¾.puml` | å±•ç¤ºæ‰€æœ‰æ ¸å¿ƒç±»ã€æ¥å£åŠå…¶å…³ç³» | å¼€å‘äººå‘˜ã€æŠ€æœ¯è¯„å®¡ |
| â±ï¸ **æ—¶åºå›¾** | `æ”¯ä»˜æ¶æ„-æ—¶åºå›¾.puml` | å®Œæ•´çš„æ”¯ä»˜æµç¨‹æ—¶åºäº¤äº’ | å¼€å‘äººå‘˜ã€æµ‹è¯•å›¢é˜Ÿ |
| ğŸ“¦ **ç»„ä»¶å›¾** | `æ”¯ä»˜æ¶æ„-ç»„ä»¶å›¾.puml` | ç³»ç»Ÿç»„ä»¶ã€å¤–éƒ¨ä¾èµ–åŠéƒ¨ç½²è§†å›¾ | è¿ç»´å›¢é˜Ÿã€æŠ€æœ¯è¯„å®¡ |
| ğŸ”„ **æµç¨‹å›¾** | `æ”¯ä»˜æ¶æ„-æµç¨‹å›¾.puml` | ç­–ç•¥åŒ¹é…ä¸æ‰§è¡Œçš„è¯¦ç»†æµç¨‹ | å¼€å‘äººå‘˜ã€æŠ€æœ¯åŸ¹è®­ |
| ğŸ’¼ **VPæ±‡æŠ¥ç‰ˆ** | `æ”¯ä»˜æ¶æ„-VPæ±‡æŠ¥ç‰ˆ.puml` | æŠ€æœ¯æ¶æ„ä¸ä¸šåŠ¡ä»·å€¼ç»“åˆ | CTOã€æŠ€æœ¯VPæ±‡æŠ¥ |
| â­ **é«˜ç®¡ç®€ç‰ˆ** | `æ”¯ä»˜æ¶æ„-é«˜ç®¡æ±‡æŠ¥ç®€ç‰ˆ.puml` | èšç„¦ä¸šåŠ¡ä»·å€¼å’ŒROI | CEOã€è‘£äº‹ä¼šæ±‡æŠ¥ |

### å¦‚ä½•æŸ¥çœ‹æ¶æ„å›¾

**æ–¹å¼ä¸€ï¼šåœ¨çº¿æŸ¥çœ‹**
1. è®¿é—® [PlantUML Online Editor](http://www.plantuml.com/plantuml/uml/)
2. å¤åˆ¶å¯¹åº”çš„ `.puml` æ–‡ä»¶å†…å®¹
3. ç²˜è´´åˆ°ç¼–è¾‘å™¨å³å¯å®æ—¶é¢„è§ˆ

**æ–¹å¼äºŒï¼šæœ¬åœ°æŸ¥çœ‹**
```bash
# å®‰è£…PlantUML
brew install plantuml  # macOS
# æˆ–è€…ä½¿ç”¨IDEA/VSCodeçš„PlantUMLæ’ä»¶

# ç”Ÿæˆå›¾ç‰‡
plantuml æ”¯ä»˜æ¶æ„-ç±»å›¾.puml
plantuml æ”¯ä»˜æ¶æ„-æ—¶åºå›¾.puml
plantuml æ”¯ä»˜æ¶æ„-ç»„ä»¶å›¾.puml
plantuml æ”¯ä»˜æ¶æ„-æµç¨‹å›¾.puml
```

**æ–¹å¼ä¸‰ï¼šIDEæ’ä»¶**
- **IntelliJ IDEA**: å®‰è£… PlantUML Integration æ’ä»¶
- **VS Code**: å®‰è£… PlantUML æ’ä»¶
- ç›´æ¥åœ¨IDEä¸­æ‰“å¼€ `.puml` æ–‡ä»¶å³å¯é¢„è§ˆ

---

## ä¸€ã€æ¶æ„æ¦‚è§ˆ

### 1.1 æ ¸å¿ƒè®¾è®¡æ¨¡å¼
- **ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰**ï¼šä¸åŒæ”¯ä»˜æ¸ é“çš„ç­–ç•¥å®ç°
- **å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰**ï¼šç­–ç•¥å·¥å‚è´Ÿè´£ç­–ç•¥çš„åˆ›å»ºå’Œç®¡ç†
- **è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰**ï¼šæŒ‰ä¼˜å…ˆçº§åŒ¹é…æ”¯ä»˜ç­–ç•¥

### 1.2 æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®¢æˆ·ç«¯å±‚ (Client)                        â”‚
â”‚              å°ç¨‹åº/H5/APP å‘èµ·æ”¯ä»˜è¯·æ±‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ§åˆ¶å±‚ (Controller)                         â”‚
â”‚              PayController - æ”¯ä»˜æ¥å£æ§åˆ¶å™¨                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æœåŠ¡å±‚ (Service)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PayServiceImpl - æ”¯ä»˜æœåŠ¡å®ç°                         â”‚   â”‚
â”‚  â”‚  - è®¢å•æ ¡éªŒ                                           â”‚   â”‚
â”‚  â”‚  - ç”¨æˆ·æˆæƒ                                           â”‚   â”‚
â”‚  â”‚  - ç­–ç•¥åŒ¹é…                                           â”‚   â”‚
â”‚  â”‚  - æ”¯ä»˜æ‰§è¡Œ                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç­–ç•¥å·¥å‚å±‚ (Strategy Factory)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ChannelPaymentStrategyFactory                        â”‚   â”‚
â”‚  â”‚  - ç­–ç•¥æ³¨å†Œä¸åˆå§‹åŒ–                                   â”‚   â”‚
â”‚  â”‚  - ç­–ç•¥ä¼˜å…ˆçº§æ’åº                                     â”‚   â”‚
â”‚  â”‚  - ç­–ç•¥åŒ¹é…ä¸ç¼“å­˜                                     â”‚   â”‚
â”‚  â”‚  - åŒé‡æ£€æŸ¥é”ä¿è¯çº¿ç¨‹å®‰å…¨                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç­–ç•¥å®ç°å±‚ (Strategy Implementation)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   çˆ±è¿æ¥æ”¯ä»˜    â”‚   å¤ªå¹³æ”¯ä»˜       â”‚   é»˜è®¤ç­–ç•¥        â”‚   â”‚
â”‚  â”‚ Ailianjk       â”‚   Taiping       â”‚   Default        â”‚   â”‚
â”‚  â”‚ (ä¼˜å…ˆçº§: 1)     â”‚  (ä¼˜å…ˆçº§: 2)     â”‚ (ä¼˜å…ˆçº§: MAX)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  æ¯ä¸ªç­–ç•¥å†…éƒ¨å¯é€‰æ‹©ï¼š                                         â”‚
â”‚  - å¾®ä¿¡æ”¯ä»˜ (WX_LITE/WX_H5/WX_NATIVE)                       â”‚
â”‚  - æ”¯ä»˜å®æ”¯ä»˜ (ALIPAY_APP/ALIPAY_H5)                        â”‚
â”‚  - å…¶ä»–æ”¯ä»˜æ–¹å¼                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç¬¬ä¸‰æ–¹æ”¯ä»˜æœåŠ¡å±‚ (Payment Service)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ AilianjkPay  â”‚  WechatService â”‚  AlipayService       â”‚  â”‚
â”‚  â”‚  Service     â”‚                â”‚                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®æŒä¹…å±‚ (Repository)                     â”‚
â”‚              OrderService - è®¢å•æ•°æ®ç®¡ç†                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 2.1 æ”¯ä»˜ç­–ç•¥æ¥å£ (ChannelPaymentStrategy)

```java
/**
 * æ”¯ä»˜æ¸ é“ç­–ç•¥æ¥å£
 * å®šä¹‰æ‰€æœ‰æ”¯ä»˜ç­–ç•¥å¿…é¡»å®ç°çš„æ–¹æ³•
 */
public interface ChannelPaymentStrategy extends Ordered {
    
    /**
     * åˆ¤æ–­è¯¥ç­–ç•¥æ˜¯å¦æ”¯æŒæŒ‡å®šçš„æ”¯ä»˜ç±»å‹
     * @param payType æ”¯ä»˜ç±»å‹æ ‡è¯†
     * @return true-æ”¯æŒ, false-ä¸æ”¯æŒ
     */
    boolean support(String payType);
    
    /**
     * æ‰§è¡Œæ”¯ä»˜é€»è¾‘
     * @param context æ”¯ä»˜ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«è®¢å•ã€ç”¨æˆ·ã€æ”¯ä»˜å‚æ•°ç­‰ä¿¡æ¯
     * @return æ”¯ä»˜ç»“æœ
     */
    OrderPayResultResponse execute(PaymentContext context);
    
    /**
     * è·å–ç­–ç•¥ä¼˜å…ˆçº§
     * @return ä¼˜å…ˆçº§æ•°å€¼ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
     */
    @Override
    int getOrder();
}
```

---

### 2.2 ç­–ç•¥å·¥å‚ (ChannelPaymentStrategyFactory)

#### æ ¸å¿ƒèŒè´£
1. **ç­–ç•¥æ³¨å†Œ**: Springå®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨æ³¨å…¥æ‰€æœ‰ç­–ç•¥å®ç°
2. **ä¼˜å…ˆçº§æ’åº**: æŒ‰ç…§getOrder()è¿”å›å€¼å¯¹ç­–ç•¥æ’åº
3. **ç­–ç•¥åŒ¹é…**: æŒ‰ä¼˜å…ˆçº§é¡ºåºæŸ¥æ‰¾ç¬¬ä¸€ä¸ªæ”¯æŒçš„ç­–ç•¥
4. **ç»“æœç¼“å­˜**: ä½¿ç”¨ConcurrentHashMapç¼“å­˜åŒ¹é…ç»“æœï¼Œæå‡æ€§èƒ½
5. **çº¿ç¨‹å®‰å…¨**: ä½¿ç”¨åŒé‡æ£€æŸ¥é”ä¿è¯å¹¶å‘åœºæ™¯ä¸‹çš„æ­£ç¡®æ€§

#### å·¥ä½œæµç¨‹

```java
@Component
@Slf4j
public class ChannelPaymentStrategyFactory {
    
    // ç­–ç•¥ç¼“å­˜: payType -> Strategy
    private final Map<String, ChannelPaymentStrategy> strategyCache = new ConcurrentHashMap<>();
    
    // æ’åºåçš„ç­–ç•¥åˆ—è¡¨
    private List<ChannelPaymentStrategy> sortedStrategies;
    
    // Springè‡ªåŠ¨æ³¨å…¥æ‰€æœ‰ç­–ç•¥å®ç°
    @Autowired
    private List<ChannelPaymentStrategy> strategies;
    
    /**
     * åˆå§‹åŒ–æ–¹æ³• - åº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œ
     */
    @PostConstruct
    public void init() {
        if (strategies == null || strategies.isEmpty()) {
            throw new IllegalStateException("æœªæ‰¾åˆ°ä»»ä½•æ”¯ä»˜ç­–ç•¥å®ç°");
        }
        
        // æŒ‰ä¼˜å…ˆçº§æ’åºï¼ˆä»å°åˆ°å¤§ï¼‰
        sortedStrategies = strategies.stream()
            .sorted(Comparator.comparingInt(ChannelPaymentStrategy::getOrder))
            .collect(Collectors.toList());
        
        log.info("æ”¯ä»˜ç­–ç•¥å·¥å‚åˆå§‹åŒ–å®Œæˆï¼Œå…±{}ä¸ªç­–ç•¥", sortedStrategies.size());
        sortedStrategies.forEach(s -> 
            log.info("æ³¨å†Œç­–ç•¥: {}, ä¼˜å…ˆçº§: {}", s.getClass().getSimpleName(), s.getOrder())
        );
    }
    
    /**
     * è·å–æ”¯ä»˜ç­–ç•¥
     * @param payType æ”¯ä»˜ç±»å‹
     * @return åŒ¹é…çš„ç­–ç•¥å®ç°
     */
    public ChannelPaymentStrategy getStrategy(String payType) {
        if (StringUtils.isBlank(payType)) {
            throw new IllegalArgumentException("æ”¯ä»˜ç±»å‹ä¸èƒ½ä¸ºç©º");
        }
        
        // å…ˆæŸ¥ç¼“å­˜
        ChannelPaymentStrategy strategy = strategyCache.get(payType);
        if (strategy != null) {
            return strategy;
        }
        
        // ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ‰¾å¹¶ç¼“å­˜
        return findAndCacheStrategy(payType);
    }
    
    /**
     * æŸ¥æ‰¾ç­–ç•¥å¹¶ç¼“å­˜ï¼ˆåŒé‡æ£€æŸ¥é”ï¼‰
     */
    private ChannelPaymentStrategy findAndCacheStrategy(String payType) {
        synchronized (this) {
            // å†æ¬¡æ£€æŸ¥ç¼“å­˜ï¼ˆåŒé‡æ£€æŸ¥ï¼‰
            ChannelPaymentStrategy cached = strategyCache.get(payType);
            if (cached != null) {
                return cached;
            }
            
            log.info("å¼€å§‹æŸ¥æ‰¾æ”¯ä»˜ç­–ç•¥: payType={}, ç­–ç•¥æ€»æ•°={}", payType, sortedStrategies.size());
            
            // æŒ‰ä¼˜å…ˆçº§é¡ºåºæŸ¥æ‰¾ç¬¬ä¸€ä¸ªæ”¯æŒçš„ç­–ç•¥
            for (ChannelPaymentStrategy strategy : sortedStrategies) {
                boolean supported = strategy.support(payType);
                log.debug("æ£€æŸ¥ç­–ç•¥: {}, ä¼˜å…ˆçº§: {}, æ˜¯å¦æ”¯æŒ[{}]: {}", 
                    strategy.getClass().getSimpleName(), 
                    strategy.getOrder(), 
                    payType, 
                    supported
                );
                
                if (supported) {
                    // æ‰¾åˆ°åŒ¹é…çš„ç­–ç•¥ï¼Œç¼“å­˜å¹¶è¿”å›
                    strategyCache.put(payType, strategy);
                    log.info("åŒ¹é…æˆåŠŸ! ç­–ç•¥: {}, payType: {}", 
                        strategy.getClass().getSimpleName(), payType);
                    return strategy;
                }
            }
            
            // ç†è®ºä¸Šä¸ä¼šèµ°åˆ°è¿™é‡Œï¼Œå› ä¸ºæœ‰é»˜è®¤ç­–ç•¥å…œåº•
            throw new IllegalStateException("æœªæ‰¾åˆ°æ”¯æŒçš„æ”¯ä»˜ç­–ç•¥: " + payType);
        }
    }
}
```

---

### 2.3 ç­–ç•¥å®ç°ç¤ºä¾‹

#### 2.3.1 çˆ±è¿æ¥æ”¯ä»˜ç­–ç•¥ (AilianjkPaymentStrategy)

```java
@Component
@Slf4j
public class AilianjkPaymentStrategy implements ChannelPaymentStrategy {
    
    private static final String PAY_TYPE_AILIANJK_PAY = "ailianjkpay";
    
    @Autowired
    private AilianjkPayService ailianjkPayService;
    
    @Autowired
    private OrderService orderService;
    
    @Override
    public int getOrder() {
        return 1; // æœ€é«˜ä¼˜å…ˆçº§
    }
    
    @Override
    public boolean support(String payType) {
        boolean isSupported = PAY_TYPE_AILIANJK_PAY.equals(payType);
        log.debug("AilianjkPaymentStrategy.supportæ£€æŸ¥: payType={}, æœŸæœ›={}, åŒ¹é…={}", 
            payType, PAY_TYPE_AILIANJK_PAY, isSupported);
        return isSupported;
    }
    
    @Override
    public OrderPayResultResponse execute(PaymentContext context) {
        log.info("å¼€å§‹æ‰§è¡Œçˆ±è¿æ¥æ”¯ä»˜ç­–ç•¥");
        
        Order order = context.getOrder();
        String openId = context.getOpenId();
        OrderPayResultResponse response = context.getResponse();
        
        // çˆ±è¿æ¥æ”¯ä»˜è°ƒç”¨äºŒæ¸…æ”¯ä»˜æ¥å£
        if (PAY_TYPE_AILIANJK_PAY.equals(order.getPayType())) {
            order.setPayType("twoclear");
            
            // è°ƒç”¨çˆ±è¿æ¥æ”¯ä»˜æœåŠ¡
            String clearPay = ailianjkPayService.channelTwoClearPay(order, openId);
            
            // è§£ææ”¯ä»˜ç»“æœ
            JSONObject jsonObject = JSONObject.parseObject(clearPay);
            String payInfo = jsonObject.getString("payInfo");
            
            response.setAilianjkTwoClearpayRequest(payInfo);
            order.setOutTradeNo(order.getOrderNo());
            
            // æ›´æ–°è®¢å•
            orderService.updateById(order);
            response.setStatus(true);
        }
        
        log.info("çˆ±è¿æ¥æ”¯ä»˜ç­–ç•¥æ‰§è¡Œå®Œæˆ");
        return response;
    }
}
```

#### 2.3.2 å¤ªå¹³æ”¯ä»˜ç­–ç•¥ (TaipingChannelPaymentStrategy)

```java
@Component
@Slf4j
public class TaipingChannelPaymentStrategy implements ChannelPaymentStrategy {
    
    private static final String PAY_TYPE_TAIPING = "taiping";
    
    @Autowired
    private WechatService wechatService;
    
    @Autowired
    private AlipayService alipayService;
    
    @Autowired
    private OrderService orderService;
    
    @Override
    public int getOrder() {
        return 2; // æ¬¡ä¼˜å…ˆçº§
    }
    
    @Override
    public boolean support(String payType) {
        return PAY_TYPE_TAIPING.equals(payType);
    }
    
    @Override
    public OrderPayResultResponse execute(PaymentContext context) {
        log.info("å¼€å§‹æ‰§è¡Œå¤ªå¹³æ”¯ä»˜ç­–ç•¥");
        
        Order order = context.getOrder();
        OrderPayRequest payRequest = context.getPayRequest();
        OrderPayResultResponse response = context.getResponse();
        String payChannel = payRequest.getPayChannel();
        
        // æ ¹æ®æ”¯ä»˜æ¸ é“é€‰æ‹©ä¸åŒçš„æ”¯ä»˜æ–¹å¼
        switch (payChannel) {
            case "WX_LITE":  // å¾®ä¿¡å°ç¨‹åºæ”¯ä»˜
                return executeWechatLitePay(context);
                
            case "WX_H5":    // å¾®ä¿¡H5æ”¯ä»˜
                return executeWechatH5Pay(context);
                
            case "WX_NATIVE": // å¾®ä¿¡æ‰«ç æ”¯ä»˜
                return executeWechatNativePay(context);
                
            case "ALIPAY_APP": // æ”¯ä»˜å®APPæ”¯ä»˜
                return executeAlipayAppPay(context);
                
            case "ALIPAY_H5":  // æ”¯ä»˜å®H5æ”¯ä»˜
                return executeAlipayH5Pay(context);
                
            default:
                throw new BusinessException("ä¸æ”¯æŒçš„æ”¯ä»˜æ¸ é“: " + payChannel);
        }
    }
    
    /**
     * å¾®ä¿¡å°ç¨‹åºæ”¯ä»˜
     */
    private OrderPayResultResponse executeWechatLitePay(PaymentContext context) {
        Order order = context.getOrder();
        String openId = context.getOpenId();
        OrderPayResultResponse response = context.getResponse();
        
        // è°ƒç”¨å¾®ä¿¡å°ç¨‹åºæ”¯ä»˜
        WxPayUnifiedOrderV3Result result = wechatService.createWxLiteOrder(
            order.getOrderNo(),
            order.getPayPrice(),
            order.getProductName(),
            openId
        );
        
        response.setWxLitePayRequest(result);
        response.setStatus(true);
        
        log.info("å¾®ä¿¡å°ç¨‹åºæ”¯ä»˜è°ƒç”¨æˆåŠŸ, orderNo: {}", order.getOrderNo());
        return response;
    }
    
    /**
     * æ”¯ä»˜å®H5æ”¯ä»˜
     */
    private OrderPayResultResponse executeAlipayH5Pay(PaymentContext context) {
        Order order = context.getOrder();
        OrderPayResultResponse response = context.getResponse();
        
        // è°ƒç”¨æ”¯ä»˜å®H5æ”¯ä»˜
        AlipayTradeWapPayResponse alipayResponse = alipayService.createH5Order(
            order.getOrderNo(),
            order.getPayPrice(),
            order.getProductName()
        );
        
        response.setAlipayH5PayRequest(alipayResponse.getBody());
        response.setStatus(true);
        
        log.info("æ”¯ä»˜å®H5æ”¯ä»˜è°ƒç”¨æˆåŠŸ, orderNo: {}", order.getOrderNo());
        return response;
    }
    
    // ... å…¶ä»–æ”¯ä»˜æ–¹å¼å®ç°
}
```

#### 2.3.3 é»˜è®¤æ”¯ä»˜ç­–ç•¥ (DefaultPaymentStrategy)

```java
@Component
@Slf4j
public class DefaultPaymentStrategy implements ChannelPaymentStrategy {
    
    @Override
    public int getOrder() {
        return Integer.MAX_VALUE; // æœ€ä½ä¼˜å…ˆçº§ï¼Œä½œä¸ºå…œåº•
    }
    
    @Override
    public boolean support(String payType) {
        // é»˜è®¤ç­–ç•¥æ”¯æŒæ‰€æœ‰ç±»å‹ï¼ˆå…œåº•ï¼‰
        return true;
    }
    
    @Override
    public OrderPayResultResponse execute(PaymentContext context) {
        log.warn("ä½¿ç”¨é»˜è®¤æ”¯ä»˜ç­–ç•¥ï¼Œæ”¯ä»˜ç±»å‹æœªè¢«å…¶ä»–ç­–ç•¥å¤„ç†: {}", 
            context.getPayRequest().getPayType());
        
        OrderPayResultResponse response = context.getResponse();
        response.setStatus(false);
        response.setMessage("ä¸æ”¯æŒçš„æ”¯ä»˜ç±»å‹");
        
        return response;
    }
}
```

---

## ä¸‰ã€å…³é”®è®¾è®¡è¦ç‚¹

### 3.1 ç­–ç•¥ä¼˜å…ˆçº§è®¾è®¡

| ç­–ç•¥åç§° | ä¼˜å…ˆçº§ | æ”¯æŒç±»å‹ | è¯´æ˜ |
|---------|-------|---------|------|
| AilianjkPaymentStrategy | 1 | ailianjkpay | çˆ±è¿æ¥æ”¯ä»˜ï¼Œæœ€é«˜ä¼˜å…ˆçº§ |
| TaipingChannelPaymentStrategy | 2 | taiping | å¤ªå¹³æ”¯ä»˜ï¼Œæ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼ |
| H5ChannelPaymentStrategy | 3 | h5pay | H5æ”¯ä»˜ |
| DefaultPaymentStrategy | Integer.MAX_VALUE | * | é»˜è®¤å…œåº•ç­–ç•¥ |

### 3.2 æ”¯ä»˜æ¸ é“ä¸æ”¯ä»˜æ–¹å¼æ˜ å°„

```
TaipingChannelPaymentStrategy (å¤ªå¹³æ”¯ä»˜ç­–ç•¥)
â”œâ”€â”€ WX_LITE (å¾®ä¿¡å°ç¨‹åºæ”¯ä»˜)
â”‚   â””â”€â”€ è°ƒç”¨ WechatService.createWxLiteOrder()
â”œâ”€â”€ WX_H5 (å¾®ä¿¡H5æ”¯ä»˜)
â”‚   â””â”€â”€ è°ƒç”¨ WechatService.createWxH5Order()
â”œâ”€â”€ WX_NATIVE (å¾®ä¿¡æ‰«ç æ”¯ä»˜)
â”‚   â””â”€â”€ è°ƒç”¨ WechatService.createWxNativeOrder()
â”œâ”€â”€ ALIPAY_APP (æ”¯ä»˜å®APPæ”¯ä»˜)
â”‚   â””â”€â”€ è°ƒç”¨ AlipayService.createAppOrder()
â””â”€â”€ ALIPAY_H5 (æ”¯ä»˜å®H5æ”¯ä»˜)
    â””â”€â”€ è°ƒç”¨ AlipayService.createH5Order()
```

### 3.3 æ”¯ä»˜ä¸Šä¸‹æ–‡ (PaymentContext)

```java
@Data
@Builder
public class PaymentContext {
    /** è®¢å•ä¿¡æ¯ */
    private Order order;
    
    /** ç”¨æˆ·ä¿¡æ¯ */
    private User user;
    
    /** æ”¯ä»˜è¯·æ±‚å‚æ•° */
    private OrderPayRequest payRequest;
    
    /** å¾®ä¿¡OpenIdï¼ˆå¾®ä¿¡æ”¯ä»˜éœ€è¦ï¼‰ */
    private String openId;
    
    /** ç”¨æˆ·ID */
    private Long userId;
    
    /** æ”¯ä»˜ç»“æœå“åº” */
    private OrderPayResultResponse response;
}
```

---

## å››ã€æ”¯ä»˜æµç¨‹æ‰§è¡Œæ­¥éª¤

### 4.1 åº”ç”¨å¯åŠ¨é˜¶æ®µ
1. Springå®¹å™¨å¯åŠ¨ï¼Œæ‰«ææ‰€æœ‰ `ChannelPaymentStrategy` å®ç°ç±»
2. é€šè¿‡ `@Autowired` å°†æ‰€æœ‰ç­–ç•¥æ³¨å…¥åˆ° `ChannelPaymentStrategyFactory`
3. æ‰§è¡Œ `@PostConstruct init()` æ–¹æ³•ï¼š
   - æ£€æŸ¥ç­–ç•¥åˆ—è¡¨ä¸ä¸ºç©º
   - æŒ‰ç…§ `getOrder()` ä¼˜å…ˆçº§æ’åº
   - æ‰“å°æ—¥å¿—è®°å½•æ‰€æœ‰å·²æ³¨å†Œçš„ç­–ç•¥

### 4.2 ç”¨æˆ·å‘èµ·æ”¯ä»˜
1. å®¢æˆ·ç«¯è°ƒç”¨ `/api/payment/otherPayment` æ¥å£
2. `PayController` æ¥æ”¶è¯·æ±‚ï¼Œè½¬å‘ç»™ `PayServiceImpl`
3. `PayServiceImpl` æ‰§è¡Œå‰ç½®æ ¡éªŒï¼š
   - ç”¨æˆ·ç™»å½•æ£€æŸ¥
   - è®¢å•çŠ¶æ€æ ¡éªŒï¼ˆæ˜¯å¦å–æ¶ˆ/å·²æ”¯ä»˜ï¼‰
   - è®¢å•é‡‘é¢æ ¡éªŒ
4. å¦‚æœæ˜¯å¾®ä¿¡æ”¯ä»˜ï¼Œè°ƒç”¨ `WechatService.miniAuthCode()` è·å– `openId`
5. æ„å»º `PaymentContext` ä¸Šä¸‹æ–‡å¯¹è±¡

### 4.3 ç­–ç•¥åŒ¹é…
1. è°ƒç”¨ `ChannelPaymentStrategyFactory.getStrategy(payType)`
2. å…ˆæŸ¥è¯¢ç¼“å­˜ `strategyCache`ï¼Œå‘½ä¸­åˆ™ç›´æ¥è¿”å›
3. ç¼“å­˜æœªå‘½ä¸­ï¼Œè¿›å…¥ `findAndCacheStrategy()`ï¼š
   - ä½¿ç”¨ `synchronized` åŒæ­¥å—ï¼ˆåŒé‡æ£€æŸ¥é”ï¼‰
   - å†æ¬¡æ£€æŸ¥ç¼“å­˜ï¼ˆé˜²æ­¢å¹¶å‘é‡å¤æŸ¥æ‰¾ï¼‰
   - æŒ‰ä¼˜å…ˆçº§é¡ºåºéå† `sortedStrategies`
   - è°ƒç”¨æ¯ä¸ªç­–ç•¥çš„ `support(payType)` æ–¹æ³•
   - æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„ç­–ç•¥åï¼Œç¼“å­˜å¹¶è¿”å›
   - å¦‚æœæ‰€æœ‰ç­–ç•¥éƒ½ä¸åŒ¹é…ï¼Œæœ€ç»ˆä¼šèµ°åˆ° `DefaultPaymentStrategy`

### 4.4 ç­–ç•¥æ‰§è¡Œ
1. è°ƒç”¨åŒ¹é…åˆ°çš„ç­–ç•¥çš„ `execute(context)` æ–¹æ³•
2. ç­–ç•¥å†…éƒ¨æ ¹æ® `payChannel` é€‰æ‹©å…·ä½“æ”¯ä»˜æ–¹å¼ï¼š
   - å¾®ä¿¡æ”¯ä»˜ï¼šè°ƒç”¨ `WechatService`
   - æ”¯ä»˜å®æ”¯ä»˜ï¼šè°ƒç”¨ `AlipayService`
   - çˆ±è¿æ¥æ”¯ä»˜ï¼šè°ƒç”¨ `AilianjkPayService`
3. è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜APIï¼Œè·å–æ”¯ä»˜å‚æ•°
4. æ›´æ–°è®¢å•çŠ¶æ€
5. è¿”å›æ”¯ä»˜ç»“æœç»™å®¢æˆ·ç«¯

### 4.5 æ”¯ä»˜ç»“æœè¿”å›
1. `PayServiceImpl` æ¥æ”¶ç­–ç•¥æ‰§è¡Œç»“æœ
2. å°è£… `OrderPayResultResponse`
3. è¿”å›ç»™ `PayController`
4. é€šè¿‡HTTPå“åº”è¿”å›ç»™å®¢æˆ·ç«¯
5. å®¢æˆ·ç«¯æ ¹æ®è¿”å›çš„æ”¯ä»˜å‚æ•°è°ƒèµ·æ”¯ä»˜ï¼ˆå¦‚å¾®ä¿¡/æ”¯ä»˜å®SDKï¼‰

---

## äº”ã€æ¶æ„ä¼˜åŠ¿

### 5.1 å¯æ‰©å±•æ€§
- âœ… **æ–°å¢æ”¯ä»˜æ¸ é“**: åªéœ€å®ç° `ChannelPaymentStrategy` æ¥å£ï¼ŒSpringä¼šè‡ªåŠ¨æ³¨å†Œ
- âœ… **æ”¯ä»˜æ–¹å¼æ‰©å±•**: åœ¨ç­–ç•¥å†…éƒ¨æ–°å¢ `case` åˆ†æ”¯å³å¯æ”¯æŒæ–°çš„æ”¯ä»˜æ–¹å¼
- âœ… **æ— éœ€ä¿®æ”¹å·¥å‚ä»£ç **: ç­–ç•¥å·¥å‚é€šè¿‡åå°„å’Œä¾èµ–æ³¨å…¥è‡ªåŠ¨å‘ç°æ–°ç­–ç•¥

### 5.2 å¯ç»´æŠ¤æ€§
- âœ… **å•ä¸€èŒè´£**: æ¯ä¸ªç­–ç•¥åªå…³æ³¨è‡ªå·±çš„æ”¯ä»˜é€»è¾‘
- âœ… **å¼€é—­åŸåˆ™**: å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
- âœ… **ä½è€¦åˆ**: ç­–ç•¥ä¹‹é—´äº’ä¸ä¾èµ–ï¼Œå¯ç‹¬ç«‹æµ‹è¯•å’Œéƒ¨ç½²

### 5.3 æ€§èƒ½ä¼˜åŒ–
- âœ… **ç­–ç•¥ç¼“å­˜**: ä½¿ç”¨ `ConcurrentHashMap` ç¼“å­˜åŒ¹é…ç»“æœï¼Œé¿å…é‡å¤åŒ¹é…
- âœ… **ä¼˜å…ˆçº§æ’åº**: å¯åŠ¨æ—¶æ’åºä¸€æ¬¡ï¼Œè¿è¡Œæ—¶ç›´æ¥ä½¿ç”¨æœ‰åºåˆ—è¡¨
- âœ… **çŸ­è·¯åŒ¹é…**: æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…ç­–ç•¥åç«‹å³è¿”å›ï¼Œä¸ä¼šéå†æ‰€æœ‰ç­–ç•¥

### 5.4 çº¿ç¨‹å®‰å…¨
- âœ… **åŒé‡æ£€æŸ¥é”**: ä¿è¯å¹¶å‘åœºæ™¯ä¸‹ç¼“å­˜çš„æ­£ç¡®æ€§
- âœ… **ä¸å¯å˜é›†åˆ**: `sortedStrategies` åˆå§‹åŒ–åä¸å†ä¿®æ”¹
- âœ… **å¹¶å‘å®¹å™¨**: ä½¿ç”¨ `ConcurrentHashMap` ä½œä¸ºç¼“å­˜

---

## å…­ã€å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1: ç”¨æˆ·ä½¿ç”¨å¾®ä¿¡å°ç¨‹åºæ”¯ä»˜
```
è¯·æ±‚å‚æ•°:
{
  "channelFrom": "taiping",
  "payType": "taiping",
  "payChannel": "WX_LITE",
  "orderNo": "PT20231114001",
  "code": "wx_auth_code"
}

æ‰§è¡Œæµç¨‹:
1. åŒ¹é…åˆ° TaipingChannelPaymentStrategy (ä¼˜å…ˆçº§2)
2. æ‰§è¡Œ executeWechatLitePay()
3. è°ƒç”¨ WechatService.createWxLiteOrder()
4. è¿”å›å¾®ä¿¡å°ç¨‹åºæ”¯ä»˜å‚æ•°
5. å®¢æˆ·ç«¯è°ƒèµ·å¾®ä¿¡æ”¯ä»˜
```

### åœºæ™¯2: ç”¨æˆ·ä½¿ç”¨æ”¯ä»˜å®H5æ”¯ä»˜
```
è¯·æ±‚å‚æ•°:
{
  "channelFrom": "taiping",
  "payType": "taiping",
  "payChannel": "ALIPAY_H5",
  "orderNo": "PT20231114002"
}

æ‰§è¡Œæµç¨‹:
1. åŒ¹é…åˆ° TaipingChannelPaymentStrategy
2. æ‰§è¡Œ executeAlipayH5Pay()
3. è°ƒç”¨ AlipayService.createH5Order()
4. è¿”å›æ”¯ä»˜å®H5æ”¯ä»˜URL
5. å®¢æˆ·ç«¯è·³è½¬åˆ°æ”¯ä»˜å®æ”¶é“¶å°
```

### åœºæ™¯3: çˆ±è¿æ¥äºŒæ¸…æ”¯ä»˜
```
è¯·æ±‚å‚æ•°:
{
  "channelFrom": "ailianjkpay",
  "payType": "ailianjkpay",
  "payChannel": "WX_LITE",
  "orderNo": "PT20231114003"
}

æ‰§è¡Œæµç¨‹:
1. åŒ¹é…åˆ° AilianjkPaymentStrategy (ä¼˜å…ˆçº§1ï¼Œæœ€é«˜)
2. è°ƒç”¨ AilianjkPayService.channelTwoClearPay()
3. çˆ±è¿æ¥å¹³å°ä»£ç†æ”¯ä»˜
4. è¿”å›æ”¯ä»˜å‚æ•°
5. å®¢æˆ·ç«¯è°ƒèµ·æ”¯ä»˜
```

---

## ä¸ƒã€æ‰©å±•å»ºè®®

### 7.1 æ–°å¢æ”¯ä»˜æ¸ é“
å‡è®¾è¦æ–°å¢"é“¶è”æ”¯ä»˜"ï¼š

```java
@Component
@Slf4j
public class UnionPayStrategy implements ChannelPaymentStrategy {
    
    @Override
    public int getOrder() {
        return 3; // è®¾ç½®åˆé€‚çš„ä¼˜å…ˆçº§
    }
    
    @Override
    public boolean support(String payType) {
        return "unionpay".equals(payType);
    }
    
    @Override
    public OrderPayResultResponse execute(PaymentContext context) {
        // å®ç°é“¶è”æ”¯ä»˜é€»è¾‘
        // ...
    }
}
```

### 7.2 æ”¯æŒåŠ¨æ€é…ç½®
å¯ä»¥å°†ä¼˜å…ˆçº§ã€æ”¯ä»˜ç±»å‹ç­‰é…ç½®åŒ–ï¼š

```yaml
payment:
  strategies:
    - name: ailianjk
      priority: 1
      payTypes: [ailianjkpay]
    - name: taiping
      priority: 2
      payTypes: [taiping]
      channels: [WX_LITE, WX_H5, ALIPAY_H5]
```

### 7.3 å¢åŠ ç›‘æ§å’Œæ—¥å¿—
- æ”¯ä»˜æˆåŠŸç‡ç›‘æ§
- æ”¯ä»˜è€—æ—¶ç»Ÿè®¡
- å¼‚å¸¸å‘Šè­¦
- é“¾è·¯è¿½è¸ªï¼ˆTraceIdï¼‰

---

## å…«ã€æ€»ç»“

è¯¥æ”¯ä»˜æ¶æ„é‡‡ç”¨**ç­–ç•¥æ¨¡å¼ + å·¥å‚æ¨¡å¼**çš„ç»„åˆè®¾è®¡ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **é«˜å†…èšä½è€¦åˆ**: æ¯ä¸ªæ”¯ä»˜ç­–ç•¥ç‹¬ç«‹å°è£…
2. **æ˜“æ‰©å±•**: æ–°å¢æ”¯ä»˜æ–¹å¼åªéœ€æ·»åŠ æ–°ç­–ç•¥ç±»
3. **é«˜æ€§èƒ½**: ç­–ç•¥ç¼“å­˜ + ä¼˜å…ˆçº§æ’åº
4. **çº¿ç¨‹å®‰å…¨**: åŒé‡æ£€æŸ¥é” + å¹¶å‘å®¹å™¨
5. **çµæ´»æ€§**: æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼çš„ç»„åˆ

è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„**ä¼ä¸šçº§æ”¯ä»˜æ¶æ„è®¾è®¡**ï¼Œé€‚ç”¨äºå¤šæ¸ é“ã€å¤šæ”¯ä»˜æ–¹å¼çš„å¤æ‚æ”¯ä»˜åœºæ™¯ã€‚
