# æ¨èç³»ç»Ÿå¿«é€Ÿå…¥é—¨æŒ‡å—

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€ä½¿ç”¨

#### 1.1 è‡ªåŠ¨æ¨èï¼ˆæ¨èï¼‰
ç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„ç­–ç•¥ï¼š

```java
@Autowired
private RecommendationStrategyFactory strategyFactory;

// æ„å»ºè¯·æ±‚
RecommendationRequest request = RecommendationRequest.builder()
    .userId("user123")           // ç”¨æˆ·ID
    .medicineId("med456")        // è¯å“IDï¼ˆå¯é€‰ï¼‰
    .medicineType("WESTERN")     // è¯å“ç±»å‹
    .topN(10)                    // è¿”å›æ•°é‡
    .enableFallback(true)        // å¯ç”¨é™çº§
    .build();

// æ‰§è¡Œæ¨è
MedicineRecommendationResponse response = strategyFactory.recommend(request);

// ä½¿ç”¨ç»“æœ
for (RecommendedMedicine medicine : response.getRecommendations()) {
    System.out.println("è¯å“ID: " + medicine.getMedicineId());
    System.out.println("ç›¸ä¼¼åº¦: " + medicine.getSimilarityScore());
    System.out.println("æ¨èç†ç”±: " + medicine.getReason());
}
```

#### 1.2 æŒ‡å®šç­–ç•¥æ¨è

```java
// ä½¿ç”¨ç”¨æˆ·ååŒè¿‡æ»¤
request.setStrategyName("USER_BASED_CF");
response = strategyFactory.recommend(request);

// ä½¿ç”¨æ··åˆæ¨è
request.setStrategyName("HYBRID");
response = strategyFactory.recommend(request);
```

---

### 2. å¸¸è§åœºæ™¯ç¤ºä¾‹

#### åœºæ™¯1ï¸âƒ£ï¼šé¦–é¡µä¸ªæ€§åŒ–æ¨è

```java
/**
 * é¦–é¡µæ¨èï¼šä¸ºç™»å½•ç”¨æˆ·æ¨èå¯èƒ½æ„Ÿå…´è¶£çš„è¯å“
 */
public List<RecommendedMedicine> getHomeRecommendations(String userId) {
    RecommendationRequest request = RecommendationRequest.builder()
        .userId(userId)
        .topN(10)
        .enableFallback(true)  // æ–°ç”¨æˆ·è‡ªåŠ¨é™çº§åˆ°çƒ­é—¨æ¨è
        .build();
    
    MedicineRecommendationResponse response = strategyFactory.recommend(request);
    return response.getRecommendations();
}
```

#### åœºæ™¯2ï¸âƒ£ï¼šè¯å“è¯¦æƒ…é¡µæ¨è

```java
/**
 * ç›¸å…³è¯å“æ¨èï¼š"çœ‹äº†è¿™ä¸ªè¯å“çš„äººè¿˜çœ‹äº†..."
 */
public List<RecommendedMedicine> getSimilarMedicines(String medicineId) {
    RecommendationRequest request = RecommendationRequest.builder()
        .medicineId(medicineId)
        .strategyName("ITEM_BASED_CF")  // æŒ‡å®šä½¿ç”¨ç‰©å“ååŒè¿‡æ»¤
        .topN(6)
        .build();
    
    return strategyFactory.recommend(request).getRecommendations();
}
```

#### åœºæ™¯3ï¸âƒ£ï¼šè´­ç‰©è½¦æ¨è

```java
/**
 * è´­ç‰©è½¦æ¨èï¼š"ä¹°äº†è¿™ä¸ªçš„äººè¿˜ä¹°äº†..."
 */
public List<RecommendedMedicine> getCartRecommendations(String userId, List<String> cartMedicineIds) {
    RecommendationRequest request = RecommendationRequest.builder()
        .userId(userId)
        .strategyName("USER_BASED_CF")
        .topN(5)
        .excludeMedicineIds(cartMedicineIds)  // æ’é™¤å·²åœ¨è´­ç‰©è½¦çš„è¯å“
        .build();
    
    return strategyFactory.recommend(request).getRecommendations();
}
```

#### åœºæ™¯4ï¸âƒ£ï¼šä¸­è¥¿è¯æ›¿ä»£æ¨è

```java
/**
 * ä¸­è¥¿è¯äº’æ¨ï¼šæ¨èåŠŸæ•ˆç›¸ä¼¼çš„å¦ä¸€ç±»è¯å“
 */
public List<RecommendedMedicine> getAlternativeMedicines(String medicineId, String currentType) {
    String targetType = "TRADITIONAL".equals(currentType) ? "WESTERN" : "TRADITIONAL";
    
    RecommendationRequest request = RecommendationRequest.builder()
        .medicineId(medicineId)
        .medicineType(targetType)
        .strategyName("CONTENT_BASED")  // åŸºäºå†…å®¹æ¨è
        .topN(8)
        .build();
    
    return strategyFactory.recommend(request).getRecommendations();
}
```

#### åœºæ™¯5ï¸âƒ£ï¼šæ–°ç”¨æˆ·å†·å¯åŠ¨

```java
/**
 * æ–°ç”¨æˆ·æ¨èï¼šæ¨èçƒ­é—¨è¯å“
 */
public List<RecommendedMedicine> getNewUserRecommendations(String medicineType) {
    RecommendationRequest request = RecommendationRequest.builder()
        .medicineType(medicineType)
        .strategyName("HOT")  // çƒ­é—¨æ¨è
        .topN(10)
        .build();
    
    return strategyFactory.recommend(request).getRecommendations();
}
```

---

### 3. Controllerå±‚ç¤ºä¾‹

```java
@RestController
@RequestMapping("/api/recommendations")
public class RecommendationController {
    
    @Autowired
    private RecommendationStrategyFactory strategyFactory;
    
    /**
     * é€šç”¨æ¨èæ¥å£
     */
    @PostMapping("/recommend")
    public ResponseEntity<MedicineRecommendationResponse> recommend(
            @RequestBody RecommendationRequest request) {
        
        MedicineRecommendationResponse response = strategyFactory.recommend(request);
        return ResponseEntity.ok(response);
    }
    
    /**
     * é¦–é¡µæ¨è
     */
    @GetMapping("/home")
    public ResponseEntity<List<RecommendedMedicine>> homeRecommendations(
            @RequestParam(required = false) String userId) {
        
        RecommendationRequest request = RecommendationRequest.builder()
            .userId(userId)
            .topN(10)
            .enableFallback(true)
            .build();
        
        MedicineRecommendationResponse response = strategyFactory.recommend(request);
        return ResponseEntity.ok(response.getRecommendations());
    }
    
    /**
     * ç›¸ä¼¼è¯å“æ¨è
     */
    @GetMapping("/similar/{medicineId}")
    public ResponseEntity<List<RecommendedMedicine>> similarMedicines(
            @PathVariable String medicineId,
            @RequestParam(defaultValue = "6") Integer topN) {
        
        RecommendationRequest request = RecommendationRequest.builder()
            .medicineId(medicineId)
            .strategyName("ITEM_BASED_CF")
            .topN(topN)
            .build();
        
        MedicineRecommendationResponse response = strategyFactory.recommend(request);
        return ResponseEntity.ok(response.getRecommendations());
    }
    
    /**
     * è·å–æ‰€æœ‰å¯ç”¨ç­–ç•¥
     */
    @GetMapping("/strategies")
    public ResponseEntity<List<String>> getAllStrategies() {
        return ResponseEntity.ok(strategyFactory.getAllStrategyNames());
    }
}
```

---

### 4. å‰ç«¯è°ƒç”¨ç¤ºä¾‹

#### 4.1 JavaScript/Ajax

```javascript
// é¦–é¡µæ¨è
function loadHomeRecommendations(userId) {
    $.ajax({
        url: '/api/recommendations/home',
        type: 'GET',
        data: { userId: userId },
        success: function(recommendations) {
            recommendations.forEach(function(item) {
                console.log('æ¨èè¯å“:', item.medicineName);
                console.log('ç›¸ä¼¼åº¦:', item.similarityScore);
                console.log('æ¨èç†ç”±:', item.reason);
            });
        }
    });
}

// ç›¸ä¼¼è¯å“æ¨è
function loadSimilarMedicines(medicineId) {
    $.ajax({
        url: `/api/recommendations/similar/${medicineId}`,
        type: 'GET',
        data: { topN: 6 },
        success: function(recommendations) {
            renderRecommendations(recommendations);
        }
    });
}

// é€šç”¨æ¨è
function getRecommendations(userId, medicineId, strategyName) {
    $.ajax({
        url: '/api/recommendations/recommend',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
            userId: userId,
            medicineId: medicineId,
            strategyName: strategyName,
            topN: 10,
            enableFallback: true
        }),
        success: function(response) {
            console.log('ä½¿ç”¨ç­–ç•¥:', response.algorithm);
            console.log('æ¨èç»“æœ:', response.recommendations);
        }
    });
}
```

#### 4.2 Vue.jsç¤ºä¾‹

```vue
<template>
  <div class="recommendations">
    <h3>ä¸ºæ‚¨æ¨è</h3>
    <div class="medicine-list">
      <div v-for="item in recommendations" :key="item.medicineId" class="medicine-item">
        <img :src="item.medicineImage" :alt="item.medicineName">
        <h4>{{ item.medicineName }}</h4>
        <p class="reason">{{ item.reason }}</p>
        <span class="score">ç›¸ä¼¼åº¦: {{ (item.similarityScore * 100).toFixed(1) }}%</span>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      recommendations: []
    };
  },
  mounted() {
    this.loadRecommendations();
  },
  methods: {
    async loadRecommendations() {
      try {
        const response = await this.$http.get('/api/recommendations/home', {
          params: { userId: this.$store.state.userId }
        });
        this.recommendations = response.data;
      } catch (error) {
        console.error('åŠ è½½æ¨èå¤±è´¥:', error);
      }
    }
  }
};
</script>
```

---

### 5. é…ç½®è¯´æ˜

#### 5.1 application.ymlé…ç½®

```yaml
# æ¨èç³»ç»Ÿé…ç½®
recommendation:
  # é»˜è®¤è¿”å›æ•°é‡
  default-top-n: 10
  
  # æ˜¯å¦å¯ç”¨é™çº§
  enable-fallback: true
  
  # ç›¸ä¼¼åº¦é˜ˆå€¼
  similarity-threshold: 0.3
  
  # ç¼“å­˜é…ç½®
  cache:
    enabled: true
    ttl: 3600  # ç§’
  
  # ç­–ç•¥æƒé‡ï¼ˆæ··åˆæ¨èä½¿ç”¨ï¼‰
  strategy-weights:
    user-based-cf: 0.4
    item-based-cf: 0.4
    content-based: 0.2
```

---

### 6. è¿”å›ç»“æœè¯´æ˜

#### 6.1 å“åº”ç»“æ„

```json
{
  "algorithm": "HYBRID",
  "totalCount": 10,
  "recommendations": [
    {
      "medicineId": "med123",
      "medicineName": "æ„Ÿå†’çµé¢—ç²’",
      "medicineType": "TRADITIONAL",
      "similarityScore": 0.95,
      "reason": "ä¸æ‚¨æµè§ˆçš„è¯å“åŠŸæ•ˆç›¸ä¼¼",
      "price": 28.50,
      "manufacturer": "XXåˆ¶è¯",
      "specification": "10g*12è¢‹"
    }
  ],
  "timestamp": 1699999999999
}
```

#### 6.2 å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `algorithm` | String | ä½¿ç”¨çš„æ¨èç®—æ³• |
| `totalCount` | Integer | æ¨èç»“æœæ€»æ•° |
| `recommendations` | List | æ¨èè¯å“åˆ—è¡¨ |
| `medicineId` | String | è¯å“ID |
| `medicineName` | String | è¯å“åç§° |
| `medicineType` | String | è¯å“ç±»å‹ï¼ˆTRADITIONAL/WESTERNï¼‰ |
| `similarityScore` | Double | ç›¸ä¼¼åº¦/æ¨èåˆ†æ•°ï¼ˆ0-1ï¼‰ |
| `reason` | String | æ¨èç†ç”± |

---

### 7. å¸¸è§é—®é¢˜

**Q: æ¨èç»“æœä¸ºç©ºæ€ä¹ˆåŠï¼Ÿ**
- ç¡®ä¿å¯ç”¨äº† `enableFallback: true`
- ç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§åˆ°çƒ­é—¨æ¨è

**Q: å¦‚ä½•æé«˜æ¨èå‡†ç¡®æ€§ï¼Ÿ**
- æ”¶é›†æ›´å¤šç”¨æˆ·è¡Œä¸ºæ•°æ®
- å®šæœŸæ›´æ–°ç›¸ä¼¼åº¦çŸ©é˜µ
- ä½¿ç”¨HYBRIDæ··åˆç­–ç•¥

**Q: æ–°ç”¨æˆ·æ²¡æœ‰æ¨èæ€ä¹ˆåŠï¼Ÿ**
- ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨HOTç­–ç•¥æ¨èçƒ­é—¨è¯å“
- å¼•å¯¼ç”¨æˆ·æµè§ˆ/æ”¶è—è¯å“ä»¥å»ºç«‹ç”»åƒ

**Q: å¦‚ä½•è‡ªå®šä¹‰æ¨èç­–ç•¥ï¼Ÿ**
- å‚è€ƒè¯¦ç»†æ–‡æ¡£ï¼š`æ¨èç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£.md`
- å®ç° `RecommendationStrategy` æ¥å£

---

### 8. ä¸‹ä¸€æ­¥

- ğŸ“– é˜…è¯»å®Œæ•´æ¶æ„æ–‡æ¡£ï¼š`æ¨èç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£.md`
- ğŸ”§ æŸ¥çœ‹ç­–ç•¥å®ç°ä»£ç ï¼š`/src/main/java/com/ailian/product/recommendation/strategy/`
- ğŸ“Š ç›‘æ§æ¨èæ•ˆæœï¼šæŸ¥çœ‹æ—¥å¿—å’Œç›‘æ§é¢æ¿
- ğŸš€ æ€§èƒ½ä¼˜åŒ–ï¼šå‚è€ƒæ–‡æ¡£ç¬¬7ç« 

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æŸ¥é˜…å®Œæ•´æ–‡æ¡£ã€‚

