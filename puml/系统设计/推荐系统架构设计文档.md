# è¯å“æ¨èç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ ç›®å½•
- [1. ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
- [2. æ¶æ„è®¾è®¡](#2-æ¶æ„è®¾è®¡)
- [3. æ—¶åºå›¾](#3-æ—¶åºå›¾)
- [4. æ¨èç­–ç•¥è¯¦è§£](#4-æ¨èç­–ç•¥è¯¦è§£)
- [5. å¯æ‰©å±•æ€§è®¾è®¡](#5-å¯æ‰©å±•æ€§è®¾è®¡)
- [6. é€‚ç”¨åœºæ™¯](#6-é€‚ç”¨åœºæ™¯)
- [7. æ€§èƒ½ä¼˜åŒ–](#7-æ€§èƒ½ä¼˜åŒ–)
- [8. ç›‘æ§ä¸è¿ç»´](#8-ç›‘æ§ä¸è¿ç»´)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 ç³»ç»Ÿç®€ä»‹
è¯å“æ¨èç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºå¤šç­–ç•¥èåˆçš„æ™ºèƒ½æ¨èå¼•æ“ï¼Œä¸ºç”¨æˆ·æä¾›ä¸ªæ€§åŒ–çš„è¯å“æ¨èæœåŠ¡ã€‚ç³»ç»Ÿé‡‡ç”¨ç­–ç•¥æ¨¡å¼è®¾è®¡ï¼Œæ”¯æŒå¤šç§æ¨èç®—æ³•çš„çµæ´»ç»„åˆä¸åŠ¨æ€åˆ‡æ¢ã€‚

### 1.2 æ ¸å¿ƒç‰¹æ€§
- âœ… **å¤šç­–ç•¥æ”¯æŒ**ï¼šååŒè¿‡æ»¤ã€å†…å®¹æ¨èã€çƒ­é—¨æ¨èã€æ··åˆæ¨èç­‰
- âœ… **æ™ºèƒ½é™çº§**ï¼šç­–ç•¥å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢å¤‡é€‰ç­–ç•¥
- âœ… **çµæ´»é…ç½®**ï¼šæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€æŒ‡å®šæ¨èç­–ç•¥
- âœ… **å¯æ‰©å±•æ€§**ï¼šéµå¾ªå¼€é—­åŸåˆ™ï¼Œè½»æ¾æ·»åŠ æ–°ç­–ç•¥
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šç¼“å­˜ã€æ‰¹å¤„ç†ã€å¼‚æ­¥è®¡ç®—

### 1.3 æŠ€æœ¯æ ˆ
- Spring Boot 2.x
- MyBatis Plus
- Redisï¼ˆç¼“å­˜ï¼‰
- MySQLï¼ˆæ•°æ®å­˜å‚¨ï¼‰
- Lombok

---

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„å›¾

> ğŸ’¡ **å¯è§†åŒ–å›¾è¡¨**ï¼šæŸ¥çœ‹ [PlantUMLæ¶æ„å›¾](æ¨è/architecture.puml) æˆ– [Mermaidæ¶æ„å›¾](æ¨è/architecture.mmd)

**åœ¨çº¿é¢„è§ˆ**ï¼š
- PlantUML: å¤åˆ¶ `diagrams/architecture.puml` åˆ° http://www.plantuml.com/plantuml/uml/
- Mermaid: å¤åˆ¶ `diagrams/architecture.mmd` åˆ° https://mermaid.live/

**æ¶æ„è¯´æ˜**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å®¢æˆ·ç«¯å±‚                                 â”‚
â”‚                    (Controller / API)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ¨èæœåŠ¡å±‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      RecommendationStrategyFactoryï¼ˆç­–ç•¥å·¥å‚ï¼‰             â”‚   â”‚
â”‚  â”‚  - ç­–ç•¥æ³¨å†Œä¸ç®¡ç†                                          â”‚   â”‚
â”‚  â”‚  - è‡ªåŠ¨ç­–ç•¥é€‰æ‹©                                            â”‚   â”‚
â”‚  â”‚  - ç­–ç•¥é™çº§å¤„ç†                                            â”‚   â”‚
â”‚  â”‚  - æ··åˆæ¨è                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚         â–¼               â–¼               â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚RecommendationStrategy (ç­–ç•¥æ¥å£)                â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼               â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UserBasedCF  â”‚ â”‚ ItemBasedCF  â”‚ â”‚ContentBased  â”‚ â”‚   Hybrid     â”‚
â”‚   Strategy   â”‚ â”‚   Strategy   â”‚ â”‚  Strategy    â”‚ â”‚  Strategy    â”‚
â”‚  ä¼˜å…ˆçº§: 10  â”‚ â”‚  ä¼˜å…ˆçº§: 20  â”‚ â”‚  ä¼˜å…ˆçº§: 30  â”‚ â”‚  ä¼˜å…ˆçº§: 5   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   HotRecommendation Strategy â”‚
          â”‚   DefaultStrategy            â”‚
          â”‚   ä¼˜å…ˆçº§: 90-100             â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Mapperå±‚  â”‚  â”‚  Helperå·¥å…· â”‚  â”‚  ç¼“å­˜å±‚     â”‚
â”‚  æ•°æ®è®¿é—®   â”‚  â”‚  è¾…åŠ©è®¡ç®—   â”‚  â”‚   Redis     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æ•°æ®åº“å±‚                         â”‚
â”‚  - user_similarityï¼ˆç”¨æˆ·ç›¸ä¼¼åº¦ï¼‰                 â”‚
â”‚  - medicine_similarityï¼ˆè¯å“ç›¸ä¼¼åº¦ï¼‰             â”‚
â”‚  - user_behavior_statsï¼ˆç”¨æˆ·è¡Œä¸ºç»Ÿè®¡ï¼‰           â”‚
â”‚  - medicine_infoï¼ˆè¯å“ä¿¡æ¯ï¼‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç­–ç•¥æ¨¡å¼è®¾è®¡

> ğŸ’¡ **ç±»å›¾**ï¼šæŸ¥çœ‹ [å®Œæ•´ç±»å›¾](æ¨è/class-diagram.puml)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Â«interfaceÂ»                                â”‚
â”‚         RecommendationStrategy                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + getStrategyName(): String                             â”‚
â”‚ + recommend(request): Response                          â”‚
â”‚ + isApplicable(request): boolean                        â”‚
â”‚ + getPriority(): int                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–³
                        â”‚ implements
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚UserBasedCF   â”‚ â”‚ItemBasedCF â”‚ â”‚ContentBasedâ”‚ â”‚  Hybrid    â”‚
â”‚Strategy      â”‚ â”‚Strategy    â”‚ â”‚Strategy    â”‚ â”‚ Strategy   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 ç±»èŒè´£è¯´æ˜

| ç±»å | èŒè´£ | è®¾è®¡æ¨¡å¼ |
|------|------|----------|
| `RecommendationStrategy` | å®šä¹‰æ¨èç­–ç•¥æ¥å£ | ç­–ç•¥æ¨¡å¼ |
| `RecommendationStrategyFactory` | ç®¡ç†å’Œé€‰æ‹©ç­–ç•¥ | å·¥å‚æ¨¡å¼ |
| `UserBasedCFStrategy` | åŸºäºç”¨æˆ·çš„ååŒè¿‡æ»¤ | ç­–ç•¥å®ç° |
| `ItemBasedCFStrategy` | åŸºäºç‰©å“çš„ååŒè¿‡æ»¤ | ç­–ç•¥å®ç° |
| `ContentBasedStrategy` | åŸºäºå†…å®¹çš„æ¨è | ç­–ç•¥å®ç° |
| `HybridRecommendationStrategy` | æ··åˆæ¨èç­–ç•¥ | ç­–ç•¥å®ç° + ç»„åˆæ¨¡å¼ |
| `RecommendationHelper` | æ¨èè¾…åŠ©å·¥å…·ç±» | å·¥å…·ç±» |

---

## 3. æ—¶åºå›¾

> ğŸ’¡ **å¯è§†åŒ–æ—¶åºå›¾**ï¼š
> - [è‡ªåŠ¨ç­–ç•¥é€‰æ‹©æµç¨‹](æ¨è/sequence-auto-selection.puml)
> - [ç­–ç•¥é™çº§å¤„ç†æµç¨‹](æ¨è/sequence-fallback.puml)
> - [æ··åˆæ¨èæ‰§è¡Œæµç¨‹](æ¨è/sequence-hybrid.puml)
> - [æ¨èæµç¨‹æ€»è§ˆ(Mermaid)](æ¨è/sequence-overview.mmd)
>
> **åœ¨çº¿é¢„è§ˆ**ï¼šå¤åˆ¶å¯¹åº” .puml æ–‡ä»¶å†…å®¹åˆ° http://www.plantuml.com/plantuml/uml/

### 3.1 è‡ªåŠ¨ç­–ç•¥é€‰æ‹©æµç¨‹

> è¯¦ç»†æ—¶åºå›¾ï¼š[sequence-auto-selection.puml](æ¨è/sequence-auto-selection.puml)

**æµç¨‹è¯´æ˜**ï¼šå±•ç¤ºäº†ç³»ç»Ÿå¦‚ä½•è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æ¨èç­–ç•¥ï¼ŒåŒ…æ‹¬ç­–ç•¥é€‚ç”¨æ€§åˆ¤æ–­ã€ä¼˜å…ˆçº§æ’åºå’Œæ¨èæ‰§è¡Œçš„å®Œæ•´è¿‡ç¨‹ã€‚

```
ç”¨æˆ·      Controller    StrategyFactory    Strategy1    Strategy2    Database
â”‚            â”‚                â”‚                â”‚           â”‚            â”‚
â”œâ”€â”€è¯·æ±‚æ¨èâ”€â”€>â”‚                â”‚                â”‚           â”‚            â”‚
â”‚            â”œâ”€â”€recommend()â”€â”€>â”‚                â”‚           â”‚            â”‚
â”‚            â”‚                â”œâ”€æ£€æŸ¥æ˜¯å¦æŒ‡å®šç­–ç•¥â”‚           â”‚            â”‚
â”‚            â”‚                â”œâ”€æŒ‰ä¼˜å…ˆçº§æ’åºâ”€â”€>â”‚           â”‚            â”‚
â”‚            â”‚                â”‚                â”‚           â”‚            â”‚
â”‚            â”‚                â”œâ”€isApplicable()>â”‚           â”‚            â”‚
â”‚            â”‚                â”‚<â”€â”€â”€â”€trueâ”€â”€â”€â”€â”€â”€â”€â”¤           â”‚            â”‚
â”‚            â”‚                â”‚                â”‚           â”‚            â”‚
â”‚            â”‚                â”œâ”€â”€recommend()â”€â”€>â”‚           â”‚            â”‚
â”‚            â”‚                â”‚                â”œâ”€â”€æŸ¥è¯¢æ•°æ®â”€>â”‚            â”‚
â”‚            â”‚                â”‚                â”‚<â”€â”€è¿”å›â”€â”€â”€â”€â”¤            â”‚
â”‚            â”‚                â”‚                â”œâ”€â”€è®¡ç®—æ¨èâ”€â”‚            â”‚
â”‚            â”‚                â”‚<â”€â”€â”€è¿”å›ç»“æœâ”€â”€â”€â”€â”¤           â”‚            â”‚
â”‚            â”‚                â”‚                â”‚           â”‚            â”‚
â”‚            â”‚                â”œâ”€æ£€æŸ¥ç»“æœæ˜¯å¦ä¸ºç©ºâ”‚           â”‚            â”‚
â”‚            â”‚                â”œâ”€ç»“æœæ­£å¸¸ï¼Œè¿”å›â”€â”€â”‚           â”‚            â”‚
â”‚            â”‚<â”€â”€â”€Responseâ”€â”€â”€â”€â”¤                â”‚           â”‚            â”‚
â”‚<â”€â”€è¿”å›ç»“æœâ”€â”¤                â”‚                â”‚           â”‚            â”‚
```

### 3.2 ç­–ç•¥é™çº§æµç¨‹

> è¯¦ç»†æ—¶åºå›¾ï¼š[sequence-fallback.puml](æ¨è/sequence-fallback.puml)

**æµç¨‹è¯´æ˜**ï¼šå½“é¦–é€‰ç­–ç•¥å¤±è´¥æˆ–è¿”å›ç©ºç»“æœæ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨é™çº§åˆ°å¤‡é€‰ç­–ç•¥ï¼Œç¡®ä¿å§‹ç»ˆèƒ½è¿”å›æ¨èç»“æœã€‚

```
ç”¨æˆ·      StrategyFactory    Strategy1    Strategy2    Strategy3
â”‚              â”‚                â”‚           â”‚            â”‚
â”œâ”€è¯·æ±‚æ¨èâ”€â”€â”€â”€>â”‚                â”‚           â”‚            â”‚
â”‚              â”œâ”€é€‰æ‹©Strategy1â”€>â”‚           â”‚            â”‚
â”‚              â”‚                â”œâ”€æ‰§è¡Œå¤±è´¥â”€â”€X            â”‚
â”‚              â”‚<â”€â”€â”€å¼‚å¸¸â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚            â”‚
â”‚              â”‚                â”‚           â”‚            â”‚
â”‚              â”œâ”€å¯ç”¨é™çº§æœºåˆ¶â”€â”€â”€â”‚           â”‚            â”‚
â”‚              â”œâ”€é€‰æ‹©Strategy2â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚
â”‚              â”‚                â”‚           â”œâ”€è¿”å›ç©ºç»“æœâ”€â”‚
â”‚              â”‚<â”€â”€â”€ç©ºç»“æœâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚              â”‚                â”‚           â”‚            â”‚
â”‚              â”œâ”€ç»§ç»­é™çº§â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
â”‚              â”‚                â”‚           â”‚            â”œâ”€æˆåŠŸ
â”‚              â”‚<â”€â”€â”€è¿”å›ç»“æœâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<â”€è¿”å›ç»“æœâ”€â”€â”€â”€â”¤                â”‚           â”‚            â”‚
```

### 3.3 æ··åˆæ¨èæµç¨‹

> è¯¦ç»†æ—¶åºå›¾ï¼š[sequence-hybrid.puml](æ¨è/sequence-hybrid.puml)

**æµç¨‹è¯´æ˜**ï¼šæ··åˆç­–ç•¥å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå­ç­–ç•¥ï¼Œæ”¶é›†ç»“æœåè¿›è¡ŒåŠ æƒèåˆï¼Œè®¡ç®—ç»¼åˆå¾—åˆ†å¹¶è¿”å›æœ€ä¼˜æ¨èã€‚

```
ç”¨æˆ·    HybridStrategy  UserBasedCF  ItemBasedCF  ContentBased  Helper
â”‚           â”‚              â”‚            â”‚             â”‚           â”‚
â”œâ”€è¯·æ±‚æ¨èâ”€>â”‚              â”‚            â”‚             â”‚           â”‚
â”‚           â”œâ”€æ‰§è¡Œç­–ç•¥1â”€â”€â”€>â”‚            â”‚             â”‚           â”‚
â”‚           â”‚<â”€è¿”å›ç»“æœ1â”€â”€â”¤            â”‚             â”‚           â”‚
â”‚           â”œâ”€æ‰§è¡Œç­–ç•¥2â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚           â”‚
â”‚           â”‚<â”€è¿”å›ç»“æœ2â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚           â”‚
â”‚           â”œâ”€æ‰§è¡Œç­–ç•¥3â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚           â”‚
â”‚           â”‚<â”€è¿”å›ç»“æœ3â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚           â”‚              â”‚            â”‚             â”‚           â”‚
â”‚           â”œâ”€èšåˆæ‰€æœ‰ç»“æœâ”€â”‚            â”‚             â”‚           â”‚
â”‚           â”œâ”€è®¡ç®—ç»¼åˆå¾—åˆ†â”€â”‚            â”‚             â”‚           â”‚
â”‚           â”œâ”€æ’åºç­›é€‰â”€â”€â”€â”€â”€â”‚            â”‚             â”‚           â”‚
â”‚           â”œâ”€æ„å»ºå“åº”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
â”‚           â”‚<â”€è¿”å›æœ€ç»ˆç»“æœâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<â”€è¿”å›â”€â”€â”€â”€â”¤              â”‚            â”‚             â”‚           â”‚
```

---

## 4. æ¨èç­–ç•¥è¯¦è§£

### 4.1 ç­–ç•¥ä¼˜å…ˆçº§è¡¨

| ä¼˜å…ˆçº§ | ç­–ç•¥åç§° | ç­–ç•¥ä»£ç  | é€‚ç”¨åœºæ™¯ |
|--------|----------|----------|----------|
| 5 | æ··åˆæ¨è | `HYBRID` | ç”¨æˆ·æœ‰å†å²ã€è¯å“æœ‰å…³è”æ—¶ |
| 10 | ç”¨æˆ·ååŒè¿‡æ»¤ | `USER_BASED_CF` | ç”¨æˆ·æœ‰ç›¸ä¼¼ç”¨æˆ·æ—¶ |
| 20 | ç‰©å“ååŒè¿‡æ»¤ | `ITEM_BASED_CF` | è¯å“æœ‰ç›¸ä¼¼è¯å“æ—¶ |
| 30 | å†…å®¹æ¨è | `CONTENT_BASED` | æœ‰è¯å“ä¿¡æ¯æ—¶ |
| 90 | çƒ­é—¨æ¨è | `HOT` | å†·å¯åŠ¨åœºæ™¯ |
| 100 | é»˜è®¤æ¨è | `DEFAULT` | å…œåº•ç­–ç•¥ |

### 4.2 å„ç­–ç•¥è¯¦ç»†è¯´æ˜

#### 4.2.1 ç”¨æˆ·ååŒè¿‡æ»¤ï¼ˆUser-Based CFï¼‰

**ç®—æ³•åŸç†**ï¼š
```
1. æ‰¾åˆ°ä¸ç›®æ ‡ç”¨æˆ·ç›¸ä¼¼çš„Kä¸ªç”¨æˆ·
2. æ”¶é›†è¿™äº›ç›¸ä¼¼ç”¨æˆ·è´­ä¹°/æµè§ˆè¿‡çš„è¯å“
3. è¿‡æ»¤æ‰ç›®æ ‡ç”¨æˆ·å·²è´­ä¹°çš„è¯å“
4. è®¡ç®—æ¨èå¾—åˆ† = Î£(ç›¸ä¼¼åº¦ Ã— ç”¨æˆ·å¯¹è¯å“çš„è¯„åˆ†)
5. æŒ‰å¾—åˆ†æ’åºè¿”å›Top-N
```

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… ç”¨æˆ·æœ‰ä¸€å®šè¡Œä¸ºå†å²
- âœ… ç³»ç»Ÿæœ‰è¶³å¤Ÿå¤šçš„ç”¨æˆ·æ•°æ®
- âœ… ç”¨æˆ·è¡Œä¸ºæ¨¡å¼ç›¸å¯¹ç¨³å®š

**æ•°æ®ä¾èµ–**ï¼š
- `user_similarity` è¡¨ï¼šå­˜å‚¨ç”¨æˆ·ç›¸ä¼¼åº¦
- `user_behavior_stats` è¡¨ï¼šç”¨æˆ·è¡Œä¸ºç»Ÿè®¡

**ä¼˜ç‚¹**ï¼š
- èƒ½å‘ç°ç”¨æˆ·æ½œåœ¨å…´è¶£
- æ¨èå¤šæ ·æ€§å¥½
- å¯è§£é‡Šæ€§å¼º

**ç¼ºç‚¹**ï¼š
- å†·å¯åŠ¨é—®é¢˜ï¼ˆæ–°ç”¨æˆ·æ— æ¨èï¼‰
- è®¡ç®—å¤æ‚åº¦é«˜ O(NÃ—M)
- æ•°æ®ç¨€ç–æ€§é—®é¢˜

---

#### 4.2.2 ç‰©å“ååŒè¿‡æ»¤ï¼ˆItem-Based CFï¼‰

**ç®—æ³•åŸç†**ï¼š
```
1. åŸºäºç›®æ ‡è¯å“ï¼ŒæŸ¥æ‰¾ç›¸ä¼¼è¯å“
2. æ ¹æ®ç›¸ä¼¼åº¦æ’åº
3. å¯é€‰ï¼šç»“åˆç”¨æˆ·å†å²è¡Œä¸ºè°ƒæ•´å¾—åˆ†
4. è¿”å›Top-Nç›¸ä¼¼è¯å“
```

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… "çœ‹äº†è¿™ä¸ªè¯å“çš„äººè¿˜çœ‹äº†..."
- âœ… è¯å“å…³è”æ¨è
- âœ… ç›¸ä¼¼è¯å“æ›¿ä»£æ¨è

**æ•°æ®ä¾èµ–**ï¼š
- `medicine_similarity` è¡¨ï¼šè¯å“ç›¸ä¼¼åº¦çŸ©é˜µ

**ä¼˜ç‚¹**ï¼š
- è®¡ç®—å¯é¢„å¤„ç†ï¼Œå“åº”å¿«
- æ¨èç»“æœç¨³å®š
- é€‚åˆç‰©å“å˜åŒ–ä¸é¢‘ç¹çš„åœºæ™¯

**ç¼ºç‚¹**ï¼š
- æ¨èå¤šæ ·æ€§è¾ƒå·®
- éš¾ä»¥å‘ç°æ–°å“

---

#### 4.2.3 å†…å®¹æ¨èï¼ˆContent-Basedï¼‰

**ç®—æ³•åŸç†**ï¼š
```
1. æå–è¯å“ç‰¹å¾ï¼ˆæˆåˆ†ã€åŠŸæ•ˆã€ç±»åˆ«ç­‰ï¼‰
2. è®¡ç®—è¯å“é—´çš„å†…å®¹ç›¸ä¼¼åº¦
3. æ¨èä¸ç”¨æˆ·å–œæ¬¢çš„è¯å“å†…å®¹ç›¸ä¼¼çš„å…¶ä»–è¯å“
```

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… åŸºäºè¯å“å±æ€§æ¨è
- âœ… ä¸­è¥¿è¯åŒ¹é…æ¨è
- âœ… åŠŸæ•ˆç›¸ä¼¼è¯å“æ¨è

**ç‰¹å¾ç»´åº¦**ï¼š
- è¯å“ç±»å‹ï¼ˆä¸­è¯/è¥¿è¯ï¼‰
- ä¸»è¦æˆåˆ†
- æ²»ç–—åŠŸæ•ˆ
- é€‚åº”ç—‡
- è¯å“åˆ†ç±»

**ä¼˜ç‚¹**ï¼š
- æ— å†·å¯åŠ¨é—®é¢˜
- æ¨èå¯è§£é‡Š
- ä¸ä¾èµ–ç”¨æˆ·è¡Œä¸º

**ç¼ºç‚¹**ï¼š
- æ¨èåŒè´¨åŒ–ä¸¥é‡
- éš¾ä»¥å‘ç°è·¨ç±»åˆ«æ¨è

---

#### 4.2.4 æ··åˆæ¨èï¼ˆHybridï¼‰

**ç®—æ³•åŸç†**ï¼š
```
1. å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå­ç­–ç•¥
2. æ”¶é›†æ‰€æœ‰ç­–ç•¥çš„æ¨èç»“æœ
3. å¯¹æ¯ä¸ªè¯å“è®¡ç®—ç»¼åˆå¾—åˆ†ï¼š
   score = Î£(ç­–ç•¥å¾—åˆ†) / ç­–ç•¥æ•° Ã— log(å‡ºç°æ¬¡æ•° + 1)
4. æŒ‰ç»¼åˆå¾—åˆ†æ’åºè¿”å›Top-N
```

**èåˆç­–ç•¥**ï¼š
- åŠ æƒå¹³å‡ï¼šä¸åŒç­–ç•¥èµ‹äºˆä¸åŒæƒé‡
- æŠ•ç¥¨æœºåˆ¶ï¼šå‡ºç°æ¬¡æ•°è¶Šå¤šæƒé‡è¶Šé«˜
- å¯¹æ•°å¹³æ»‘ï¼šé¿å…å•ä¸€ç­–ç•¥ä¸»å¯¼

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… å¯¹æ¨èè´¨é‡è¦æ±‚é«˜çš„åœºæ™¯
- âœ… å¤šä¸ªç­–ç•¥éƒ½é€‚ç”¨çš„æƒ…å†µ
- âœ… éœ€è¦å¹³è¡¡å¤šæ ·æ€§å’Œå‡†ç¡®æ€§

**ä¼˜ç‚¹**ï¼š
- ç»¼åˆå¤šç­–ç•¥ä¼˜åŠ¿
- æ¨èè´¨é‡æœ€ä¼˜
- é²æ£’æ€§å¼º

**ç¼ºç‚¹**ï¼š
- è®¡ç®—å¼€é”€å¤§
- å“åº”æ—¶é—´é•¿
- éœ€è¦å¤šä¸ªç­–ç•¥éƒ½å¯ç”¨

---

#### 4.2.5 çƒ­é—¨æ¨èï¼ˆHotï¼‰

**ç®—æ³•åŸç†**ï¼š
```
1. ç»Ÿè®¡è¯å“çš„è´­ä¹°é‡ã€æµè§ˆé‡ã€æ”¶è—é‡
2. è®¡ç®—çƒ­åº¦åˆ†æ•° = w1Ã—è´­ä¹°é‡ + w2Ã—æµè§ˆé‡ + w3Ã—æ”¶è—é‡
3. æŒ‰çƒ­åº¦æ’åºè¿”å›Top-N
4. å¯é€‰ï¼šæŒ‰è¯å“ç±»å‹åˆ†ç»„æ¨è
```

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… æ–°ç”¨æˆ·å†·å¯åŠ¨
- âœ… é¦–é¡µçƒ­é—¨æ¨è
- âœ… å…¶ä»–ç­–ç•¥å¤±è´¥æ—¶çš„é™çº§æ–¹æ¡ˆ

**ä¼˜ç‚¹**ï¼š
- æ°¸è¿œå¯ç”¨ï¼ˆå…œåº•ï¼‰
- è®¡ç®—ç®€å•é«˜æ•ˆ
- é€‚åˆæ–°ç”¨æˆ·

**ç¼ºç‚¹**ï¼š
- æ— ä¸ªæ€§åŒ–
- é©¬å¤ªæ•ˆåº”ï¼ˆçƒ­é—¨æ›´çƒ­ï¼‰

---

## 5. å¯æ‰©å±•æ€§è®¾è®¡

### 5.1 æ·»åŠ æ–°ç­–ç•¥

éµå¾ªå¼€é—­åŸåˆ™ï¼Œæ·»åŠ æ–°ç­–ç•¥åªéœ€3æ­¥ï¼š

#### Step 1: åˆ›å»ºç­–ç•¥ç±»

```java
@Component
public class MyNewStrategy implements RecommendationStrategy {
    
    @Override
    public String getStrategyName() {
        return "MY_NEW_STRATEGY";
    }
    
    @Override
    public int getPriority() {
        return 15; // è®¾ç½®ä¼˜å…ˆçº§
    }
    
    @Override
    public boolean isApplicable(RecommendationRequest request) {
        // åˆ¤æ–­ç­–ç•¥æ˜¯å¦é€‚ç”¨
        return request.getSomeCondition() != null;
    }
    
    @Override
    public MedicineRecommendationResponse recommend(RecommendationRequest request) {
        // å®ç°æ¨èé€»è¾‘
        return MedicineRecommendationResponse.builder()
                .algorithm(getStrategyName())
                .recommendations(results)
                .build();
    }
}
```

#### Step 2: Springè‡ªåŠ¨æ³¨å†Œ

ç”±äºä½¿ç”¨äº†`@Component`æ³¨è§£ï¼ŒSpringä¼šè‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œåˆ°`RecommendationStrategyFactory`ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ã€‚

#### Step 3: ä½¿ç”¨æ–°ç­–ç•¥

```java
// æ–¹å¼1ï¼šè‡ªåŠ¨é€‰æ‹©ï¼ˆæ ¹æ®ä¼˜å…ˆçº§å’Œé€‚ç”¨æ€§ï¼‰
RecommendationRequest request = new RecommendationRequest();
response = strategyFactory.recommend(request);

// æ–¹å¼2ï¼šæ˜¾å¼æŒ‡å®šç­–ç•¥
request.setStrategyName("MY_NEW_STRATEGY");
response = strategyFactory.recommend(request);
```

### 5.2 æ‰©å±•ç‚¹è®¾è®¡

| æ‰©å±•ç‚¹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| **æ–°å¢ç­–ç•¥** | å®ç°`RecommendationStrategy`æ¥å£ | æ·±åº¦å­¦ä¹ æ¨èã€å›¾ç¥ç»ç½‘ç»œæ¨è |
| **è‡ªå®šä¹‰è¯„åˆ†** | é‡å†™`calculateScore()`æ–¹æ³• | æ—¶é—´è¡°å‡ã€åœ°åŸŸåå¥½ |
| **è¿‡æ»¤è§„åˆ™** | æ‰©å±•`RecommendationHelper` | åº“å­˜è¿‡æ»¤ã€å¤„æ–¹è¯é™åˆ¶ |
| **å¤šç»´åº¦ç›¸ä¼¼åº¦** | æ‰©å±•ç›¸ä¼¼åº¦è®¡ç®— | è¯­ä¹‰ç›¸ä¼¼åº¦ã€çŸ¥è¯†å›¾è°± |
| **ä¸ªæ€§åŒ–å‚æ•°** | æ‰©å±•`RecommendationRequest` | ç”¨æˆ·ç”»åƒã€åœºæ™¯ä¸Šä¸‹æ–‡ |

### 5.3 é…ç½®åŒ–è®¾è®¡

```yaml
# application.yml
recommendation:
  # ç­–ç•¥é…ç½®
  strategies:
    user-based-cf:
      enabled: true
      priority: 10
      min-similar-users: 5
      topN: 20
    
    item-based-cf:
      enabled: true
      priority: 20
      min-similarity: 0.3
    
    hybrid:
      enabled: true
      weights:
        user-based: 0.4
        item-based: 0.4
        content-based: 0.2
  
  # ç¼“å­˜é…ç½®
  cache:
    enabled: true
    ttl: 3600 # ç§’
    
  # é™çº§é…ç½®
  fallback:
    enabled: true
    max-retry: 3
```

### 5.4 æœªæ¥æ‰©å±•æ–¹å‘

#### 5.4.1 æœºå™¨å­¦ä¹ é›†æˆ

```java
@Component
public class MLRecommendationStrategy implements RecommendationStrategy {
    
    @Autowired
    private MLModelService mlModelService;
    
    @Override
    public MedicineRecommendationResponse recommend(RecommendationRequest request) {
        // è°ƒç”¨Python MLæœåŠ¡
        List<String> predictions = mlModelService.predict(
            request.getUserId(),
            request.getFeatures()
        );
        return buildResponse(predictions);
    }
}
```

#### 5.4.2 å®æ—¶è®¡ç®—

```java
@Component
public class RealtimeRecommendationStrategy implements RecommendationStrategy {
    
    @Autowired
    private KafkaConsumer behaviorConsumer;
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    @Override
    public MedicineRecommendationResponse recommend(RecommendationRequest request) {
        // å®æ—¶è¯»å–ç”¨æˆ·è¡Œä¸ºæµ
        // ç»“åˆRedisä¸­çš„å®æ—¶ç‰¹å¾
        // å¿«é€Ÿè®¡ç®—æ¨èç»“æœ
    }
}
```

#### 5.4.3 çŸ¥è¯†å›¾è°±æ¨è

```java
@Component
public class KnowledgeGraphRecommendationStrategy implements RecommendationStrategy {
    
    @Autowired
    private Neo4jTemplate neo4jTemplate;
    
    @Override
    public MedicineRecommendationResponse recommend(RecommendationRequest request) {
        // åŸºäºè¯å“çŸ¥è¯†å›¾è°±
        // æŸ¥è¯¢ç–¾ç—…-ç—‡çŠ¶-è¯å“å…³ç³»
        // æ¨èåˆç†ç”¨è¯æ–¹æ¡ˆ
    }
}
}
```

---

## 6. é€‚ç”¨åœºæ™¯

### 6.1 åœºæ™¯çŸ©é˜µ

| åœºæ™¯ | æ¨èç­–ç•¥ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|----------|--------|------|
| **æ–°ç”¨æˆ·é¦–æ¬¡è®¿é—®** | HOT | ğŸ”´ å¿…é€‰ | å†·å¯åŠ¨ï¼Œæ¨èçƒ­é—¨è¯å“ |
| **ç”¨æˆ·æµè§ˆè¯å“è¯¦æƒ…** | ITEM_BASED_CF | ğŸŸ¢ æ¨è | "ç›¸å…³è¯å“æ¨è" |
| **ç”¨æˆ·æ·»åŠ è´­ç‰©è½¦å** | USER_BASED_CF | ğŸŸ¢ æ¨è | "ä¹°äº†è¿™ä¸ªçš„äººè¿˜ä¹°äº†..." |
| **ç”¨æˆ·æœ‰è´­ä¹°å†å²** | HYBRID | ğŸŸ¡ ä¼˜é€‰ | ç»¼åˆæ¨èï¼Œè´¨é‡æœ€ä¼˜ |
| **è¯å“æœç´¢ç»“æœé¡µ** | CONTENT_BASED | ğŸŸ¢ æ¨è | åŸºäºæœç´¢æ„å›¾æ¨è |
| **ä¸­è¥¿è¯æ›¿ä»£æ¨è** | CONTENT_BASED | ğŸ”´ å¿…é€‰ | æŒ‰æˆåˆ†å’ŒåŠŸæ•ˆæ¨è |
| **å¤„æ–¹è¯æ¨è** | CONTENT_BASED + è§„åˆ™è¿‡æ»¤ | ğŸ”´ å¿…é€‰ | éœ€è¦å¤„æ–¹èµ„è´¨éªŒè¯ |
| **æ…¢ç—…ç”¨è¯ç®¡ç†** | USER_BASED_CF | ğŸŸ¢ æ¨è | é•¿æœŸç”¨è¯æ¨è |
| **é¦–é¡µä¸ªæ€§åŒ–æ¨è** | HYBRID | ğŸŸ¡ ä¼˜é€‰ | ç»¼åˆå¤šç»´åº¦ |
| **è¥é”€æ´»åŠ¨æ¨è** | HOT + è§„åˆ™ | ğŸŸ¢ æ¨è | çƒ­é”€å•†å“+æ´»åŠ¨ç­›é€‰ |

### 6.2 å…¸å‹ä¸šåŠ¡æµç¨‹

#### åœºæ™¯1ï¼šæ–°ç”¨æˆ·é¦–æ¬¡è®¿é—®

```
ç”¨æˆ·è®¿é—® â†’ æ— å†å²æ•°æ® â†’ HOTç­–ç•¥ â†’ æ¨èçƒ­é—¨è¯å“
â””â”€ ç”¨æˆ·æµè§ˆè¯å“A â†’ ITEM_BASED_CF â†’ æ¨èç›¸ä¼¼è¯å“
   â””â”€ ç”¨æˆ·åŠ è´­è¯å“B â†’ è®°å½•è¡Œä¸º â†’ ä¸‹æ¬¡ä½¿ç”¨USER_BASED_CF
```

#### åœºæ™¯2ï¼šè€ç”¨æˆ·ä¸ªæ€§åŒ–æ¨è

```
ç”¨æˆ·ç™»å½• â†’ æœ‰ä¸°å¯Œå†å² â†’ HYBRIDç­–ç•¥
â”œâ”€ USER_BASED_CFï¼šåŸºäºç›¸ä¼¼ç”¨æˆ·
â”œâ”€ ITEM_BASED_CFï¼šåŸºäºè´­ä¹°å†å²
â””â”€ CONTENT_BASEDï¼šåŸºäºåå¥½ç±»åˆ«
  â†’ èåˆç»“æœ â†’ Top-10æ¨è
```

#### åœºæ™¯3ï¼šè¯å“è¯¦æƒ…é¡µ

```
ç”¨æˆ·æŸ¥çœ‹è¯å“A â†’ ITEM_BASED_CFä¼˜å…ˆ
â”œâ”€ æŸ¥è¯¢medicine_similarityè¡¨
â”œâ”€ è·å–Top-20ç›¸ä¼¼è¯å“
â””â”€ å¯é€‰ï¼šç»“åˆç”¨æˆ·åå¥½æ’åº
  â†’ "ç›¸å…³æ¨è"æ¨¡å—
```

### 6.3 æ€§èƒ½è¦æ±‚

| åœºæ™¯ | å“åº”æ—¶é—´è¦æ±‚ | QPS | æ¨èæ•°é‡ |
|------|-------------|-----|---------|
| é¦–é¡µæ¨è | < 100ms | 1000 | 10 |
| è¯¦æƒ…é¡µæ¨è | < 200ms | 500 | 6-8 |
| æœç´¢ç»“æœæ¨è | < 150ms | 300 | 10 |
| è´­ç‰©è½¦æ¨è | < 200ms | 200 | 5 |

---

## 7. æ€§èƒ½ä¼˜åŒ–

### 7.1 ç¼“å­˜ç­–ç•¥

#### 7.1.1 å¤šçº§ç¼“å­˜æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ¬åœ°ç¼“å­˜   â”‚ â† Caffeine (1min TTL)
â”‚  (L1 Cache) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Miss
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redisç¼“å­˜   â”‚ â† Redis (1hour TTL)
â”‚  (L2 Cache) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Miss
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®åº“    â”‚ â† MySQL
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 7.1.2 ç¼“å­˜Keyè®¾è®¡

```
# ç”¨æˆ·ç›¸ä¼¼åº¦
rec:user_sim:{userId}:v1 â†’ List<UserSimilarity>

# è¯å“ç›¸ä¼¼åº¦
rec:medicine_sim:{medicineId}:v1 â†’ List<MedicineSimilarity>

# æ¨èç»“æœ
rec:result:{strategyName}:{userId}:{medicineId} â†’ Response

# çƒ­é—¨æ¦œå•
rec:hot:{medicineType}:daily â†’ List<HotMedicine>
```

### 7.2 æ•°æ®åº“ä¼˜åŒ–

#### 7.2.1 ç´¢å¼•è®¾è®¡

```sql
-- user_similarityè¡¨
CREATE INDEX idx_user1_similarity ON user_similarity(user_id_1, similarity_score DESC);
CREATE INDEX idx_user2 ON user_similarity(user_id_2);

-- medicine_similarityè¡¨
CREATE INDEX idx_medicine1_similarity ON medicine_similarity(medicine_id_1, similarity_score DESC);
CREATE INDEX idx_medicine2 ON medicine_similarity(medicine_id_2);

-- user_behavior_statsè¡¨
CREATE INDEX idx_user_medicine ON user_behavior_stats(user_id, medicine_id);
CREATE INDEX idx_behavior_time ON user_behavior_stats(behavior_type, last_behavior_time);
```

#### 7.2.2 æŸ¥è¯¢ä¼˜åŒ–

```java
// æ‰¹é‡æŸ¥è¯¢ï¼Œå‡å°‘æ•°æ®åº“äº¤äº’
List<String> userIds = similarUsers.stream()
    .map(UserSimilarity::getUserId2)
    .collect(Collectors.toList());

// ä¸€æ¬¡æ€§æŸ¥è¯¢æ‰€æœ‰ç›¸ä¼¼ç”¨æˆ·çš„è¡Œä¸º
List<UserBehaviorStats> behaviors = behaviorStatsMapper.selectBatchByUserIds(userIds);

// ä½¿ç”¨MyBatis Plusæ‰¹é‡æ“ä½œ
saveBatch(behaviors, 1000); // æ¯æ‰¹1000æ¡
```

### 7.3 å¼‚æ­¥è®¡ç®—

```java
@Service
public class AsyncRecommendationService {
    
    @Async("recommendationExecutor")
    public CompletableFuture<List<String>> computeUserBasedCF(String userId) {
        // å¼‚æ­¥è®¡ç®—ç”¨æˆ·ååŒè¿‡æ»¤
        return CompletableFuture.completedFuture(results);
    }
    
    public MedicineRecommendationResponse parallelRecommend(RecommendationRequest request) {
        CompletableFuture<List<String>> cf1 = computeUserBasedCF(request.getUserId());
        CompletableFuture<List<String>> cf2 = computeItemBasedCF(request.getMedicineId());
        CompletableFuture<List<String>> cb = computeContentBased(request);
        
        // ç­‰å¾…æ‰€æœ‰ç»“æœ
        CompletableFuture.allOf(cf1, cf2, cb).join();
        
        // åˆå¹¶ç»“æœ
        return mergeResults(cf1.get(), cf2.get(), cb.get());
    }
}
```

### 7.4 é¢„è®¡ç®—ç­–ç•¥

```java
@Scheduled(cron = "0 0 2 * * ?") // æ¯å¤©å‡Œæ™¨2ç‚¹
public void precomputeSimilarities() {
    log.info("å¼€å§‹é¢„è®¡ç®—ç›¸ä¼¼åº¦...");
    
    // 1. è®¡ç®—ç”¨æˆ·ç›¸ä¼¼åº¦çŸ©é˜µ
    computeUserSimilarityMatrix();
    
    // 2. è®¡ç®—è¯å“ç›¸ä¼¼åº¦çŸ©é˜µ
    computeMedicineSimilarityMatrix();
    
    // 3. é¢„çƒ­çƒ­é—¨æ¦œå•
    warmupHotMedicines();
    
    log.info("é¢„è®¡ç®—å®Œæˆ");
}
```

---

## 8. ç›‘æ§ä¸è¿ç»´

### 8.1 ç›‘æ§æŒ‡æ ‡

#### 8.1.1 ä¸šåŠ¡æŒ‡æ ‡

| æŒ‡æ ‡ | è¯´æ˜ | é˜ˆå€¼ |
|------|------|------|
| æ¨èè¦†ç›–ç‡ | èƒ½è·å¾—æ¨èçš„ç”¨æˆ·æ¯”ä¾‹ | > 95% |
| æ¨èç‚¹å‡»ç‡ | æ¨èç»“æœçš„ç‚¹å‡»ç‡ | > 5% |
| æ¨èè½¬åŒ–ç‡ | æ¨èå¸¦æ¥çš„è´­ä¹°è½¬åŒ–ç‡ | > 2% |
| ç­–ç•¥ä½¿ç”¨åˆ†å¸ƒ | å„ç­–ç•¥çš„ä½¿ç”¨å æ¯” | å‡è¡¡ |
| é™çº§è§¦å‘ç‡ | ç­–ç•¥é™çº§çš„é¢‘ç‡ | < 5% |

#### 8.1.2 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | è¯´æ˜ | é˜ˆå€¼ |
|------|------|------|
| å“åº”æ—¶é—´ (P99) | 99åˆ†ä½å“åº”æ—¶é—´ | < 500ms |
| QPS | æ¯ç§’æŸ¥è¯¢æ•° | > 500 |
| ç¼“å­˜å‘½ä¸­ç‡ | Redisç¼“å­˜å‘½ä¸­ç‡ | > 80% |
| æ•°æ®åº“æ…¢æŸ¥è¯¢ | æ…¢æŸ¥è¯¢æ•°é‡ | < 10/min |
| é”™è¯¯ç‡ | æ¨èå¤±è´¥æ¯”ä¾‹ | < 0.1% |

### 8.2 æ—¥å¿—è§„èŒƒ

```java
// æ¨èå¼€å§‹
log.info("ã€æ¨èè¯·æ±‚ã€‘userId={}, medicineId={}, type={}, topN={}", 
    request.getUserId(), request.getMedicineId(), 
    request.getMedicineType(), request.getTopN());

// ç­–ç•¥é€‰æ‹©
log.info("ã€ç­–ç•¥é€‰æ‹©ã€‘è‡ªåŠ¨é€‰æ‹©ç­–ç•¥: {} (ä¼˜å…ˆçº§: {})", 
    strategy.getStrategyName(), strategy.getPriority());

// æ¨èç»“æœ
log.info("ã€æ¨èå®Œæˆã€‘è¿”å› {} ä¸ªç»“æœï¼Œè€—æ—¶: {}msï¼Œç­–ç•¥: {}", 
    response.getRecommendations().size(), duration, strategy.getStrategyName());

// å¼‚å¸¸æƒ…å†µ
log.warn("ã€ç­–ç•¥é™çº§ã€‘ç­–ç•¥ {} æœªè¿”å›ç»“æœï¼Œå°è¯•é™çº§", strategy.getStrategyName());
log.error("ã€æ¨èå¤±è´¥ã€‘ç­–ç•¥ {} æ‰§è¡Œå¼‚å¸¸", strategy.getStrategyName(), e);
```

### 8.3 å‘Šè­¦è§„åˆ™

```yaml
alerts:
  - name: æ¨èå“åº”æ—¶é—´è¿‡é•¿
    condition: p99_latency > 1000ms
    duration: 5m
    severity: warning
    
  - name: æ¨èé”™è¯¯ç‡è¿‡é«˜
    condition: error_rate > 1%
    duration: 3m
    severity: critical
    
  - name: ç¼“å­˜å‘½ä¸­ç‡è¿‡ä½
    condition: cache_hit_rate < 70%
    duration: 10m
    severity: warning
    
  - name: ç­–ç•¥é™çº§é¢‘ç¹
    condition: fallback_rate > 10%
    duration: 5m
    severity: warning
```

### 8.4 A/Bæµ‹è¯•

```java
@Component
public class ABTestRecommendationStrategy implements RecommendationStrategy {
    
    @Override
    public MedicineRecommendationResponse recommend(RecommendationRequest request) {
        // æ ¹æ®ç”¨æˆ·IDå“ˆå¸Œåˆ†æµ
        int bucket = Math.abs(request.getUserId().hashCode()) % 100;
        
        if (bucket < 50) {
            // Aç»„ï¼šä½¿ç”¨åŸç­–ç•¥
            log.info("ã€A/Bæµ‹è¯•ã€‘ç”¨æˆ· {} è¿›å…¥Aç»„", request.getUserId());
            return strategyA.recommend(request);
        } else {
            // Bç»„ï¼šä½¿ç”¨æ–°ç­–ç•¥
            log.info("ã€A/Bæµ‹è¯•ã€‘ç”¨æˆ· {} è¿›å…¥Bç»„", request.getUserId());
            return strategyB.recommend(request);
        }
    }
}
```

---

## 9. æœ€ä½³å®è·µ

### 9.1 å¼€å‘è§„èŒƒ

âœ… **DO**:
- æ–°ç­–ç•¥å¿…é¡»å®ç°`RecommendationStrategy`æ¥å£
- ä½¿ç”¨`@Slf4j`è®°å½•å…³é”®æ—¥å¿—
- ä½¿ç”¨Builderæ¨¡å¼æ„å»ºè¿”å›å¯¹è±¡
- å¼‚å¸¸æ—¶è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯
- ä½¿ç”¨ç¼“å­˜å‡å°‘æ•°æ®åº“æŸ¥è¯¢

âŒ **DON'T**:
- ä¸è¦åœ¨ç­–ç•¥ä¸­ç¡¬ç¼–ç ä¸šåŠ¡é€»è¾‘
- ä¸è¦é˜»å¡ä¸»çº¿ç¨‹åšè€—æ—¶è®¡ç®—
- ä¸è¦è¿”å›nullï¼Œè¿”å›ç©ºåˆ—è¡¨
- ä¸è¦å¿½ç•¥å¼‚å¸¸
- ä¸è¦åœ¨å¾ªç¯ä¸­æŸ¥è¯¢æ•°æ®åº“

### 9.2 æµ‹è¯•å»ºè®®

```java
@SpringBootTest
public class RecommendationStrategyTest {
    
    @Test
    public void testUserBasedCF() {
        // 1. å‡†å¤‡æµ‹è¯•æ•°æ®
        RecommendationRequest request = buildTestRequest();
        
        // 2. æ‰§è¡Œæ¨è
        MedicineRecommendationResponse response = strategy.recommend(request);
        
        // 3. éªŒè¯ç»“æœ
        assertNotNull(response);
        assertTrue(response.getRecommendations().size() > 0);
        assertEquals("USER_BASED_CF", response.getAlgorithm());
    }
    
    @Test
    public void testFallback() {
        // æµ‹è¯•é™çº§é€»è¾‘
    }
}
```

---

## 10. å¸¸è§é—®é¢˜ (FAQ)

### Q1: å¦‚ä½•é€‰æ‹©åˆé€‚çš„æ¨èç­–ç•¥ï¼Ÿ

**A**: å‚è€ƒä»¥ä¸‹å†³ç­–æ ‘ï¼š

```
ç”¨æˆ·æ˜¯å¦æœ‰å†å²è¡Œä¸ºï¼Ÿ
â”œâ”€ æ˜¯ â†’ æ•°æ®é‡æ˜¯å¦å……è¶³(>10æ¡)ï¼Ÿ
â”‚   â”œâ”€ æ˜¯ â†’ ä½¿ç”¨HYBRIDæˆ–USER_BASED_CF
â”‚   â””â”€ å¦ â†’ ä½¿ç”¨ITEM_BASED_CFæˆ–CONTENT_BASED
â””â”€ å¦ â†’ ä½¿ç”¨HOTæˆ–DEFAULT
```

### Q2: æ¨èç»“æœä¸ºç©ºæ€ä¹ˆåŠï¼Ÿ

**A**: ç³»ç»Ÿå·²å†…ç½®é™çº§æœºåˆ¶ï¼š
1. å¯ç”¨`enableFallback=true`
2. ç³»ç»Ÿä¼šè‡ªåŠ¨å°è¯•ä¸‹ä¸€ä¸ªä¼˜å…ˆçº§çš„ç­–ç•¥
3. æœ€ç»ˆä¼šé™çº§åˆ°HOTæˆ–DEFAULTç­–ç•¥ä¿è¯æœ‰ç»“æœ

### Q3: å¦‚ä½•æé«˜æ¨èå‡†ç¡®æ€§ï¼Ÿ

**A**: 
1. å®šæœŸæ›´æ–°ç›¸ä¼¼åº¦çŸ©é˜µï¼ˆå»ºè®®æ¯å¤©ï¼‰
2. æ”¶é›†ç”¨æˆ·åé¦ˆï¼ˆç‚¹å‡»ã€è´­ä¹°ã€æ”¶è—ï¼‰
3. ä½¿ç”¨HYBRIDç­–ç•¥èåˆå¤šä¸ªç®—æ³•
4. è°ƒæ•´ç­–ç•¥æƒé‡å’Œå‚æ•°
5. å¼•å…¥æ›´å¤šç‰¹å¾ç»´åº¦

### Q4: æ€§èƒ½ä¼˜åŒ–æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ

**A**:
1. å¯ç”¨å¤šçº§ç¼“å­˜ï¼ˆæœ¬åœ°+Redisï¼‰
2. é¢„è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ
3. ä½¿ç”¨å¼‚æ­¥å’Œå¹¶è¡Œè®¡ç®—
4. æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
5. é™åˆ¶æ¨èæ•°é‡ï¼ˆtopNä¸å®œè¿‡å¤§ï¼‰

---

## 11. ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|----------|------|
| v1.0 | 2025-11-14 | åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«5ç§åŸºç¡€ç­–ç•¥ | Team |
| v1.1 | - | è®¡åˆ’æ·»åŠ æ·±åº¦å­¦ä¹ ç­–ç•¥ | - |
| v2.0 | - | è®¡åˆ’æ”¯æŒå®æ—¶æ¨è | - |

---

